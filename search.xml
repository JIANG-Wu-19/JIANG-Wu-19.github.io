<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>数据库笔记</title>
      <link href="/2023/07/05/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/"/>
      <url>/2023/07/05/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="数据库基本概念"><a href="#数据库基本概念" class="headerlink" title="数据库基本概念"></a>数据库基本概念</h2><h3 id="数据库三大部分"><a href="#数据库三大部分" class="headerlink" title="数据库三大部分"></a>数据库三大部分</h3><ul><li><strong>数据库</strong></li><li><strong>数据库管理系统</strong><ul><li>描述数据库</li><li>管理数据库</li><li>维护数据库</li><li>数据通信</li></ul></li><li><strong>数据库应用程序</strong></li></ul><h3 id="数据库系统的三级结构、两级独立性"><a href="#数据库系统的三级结构、两级独立性" class="headerlink" title="数据库系统的三级结构、两级独立性"></a>数据库系统的三级结构、两级独立性</h3><ul><li>三级结构<ul><li>用户级-对应外模式<ul><li><strong>最接近于用户的一级数据库，是用户看到和使用的数据库，又称用户视图</strong></li><li><strong>不同用户视图可以互相重叠，用户的所有操作都是针对用户视图进行</strong></li></ul></li><li>概念级-对应概念模式<ul><li><strong>介于用户级和物理级之间，是所有用户视图的最小并集</strong></li><li><strong>是数据库管理员看到和使用的数据库，又称DBA视图</strong></li></ul></li><li>物理级-对应内模式<ul><li><strong>数据库的低层表示，它描述数据的实际存贮组织</strong></li><li><strong>是最接近于物理存贮的级，又称内部视图。</strong></li><li><strong>构成：内部记录组成，物理级数据库并不是真正的物理存贮，而是是最接近于物理存贮的级</strong></li></ul></li></ul></li><li>外模式-概念模式映射、概念模式-内模式映射</li><li><strong>三个抽象级间通过两级映射（根据一定的对应规则）进行相互转换，使得数据库的三级形成一个统一整体</strong></li><li><strong>映射隔离了各层之间的相互影响，实现数据独立性</strong></li><li><strong>各层间的映射能力决定数据独立性程度</strong></li><li>两级独立性<ul><li>物理独立性<ul><li><strong>存在于概念模式和内模式之间的映射转换实现物理独立性</strong></li></ul></li><li>逻辑独立性<ul><li><strong>存在于外模式和概念模式之间的映射转换实现逻辑独立性</strong></li></ul></li></ul></li></ul><h3 id="数据库应用程序的体系结构类型"><a href="#数据库应用程序的体系结构类型" class="headerlink" title="数据库应用程序的体系结构类型"></a>数据库应用程序的体系结构类型</h3><ul><li>单层<ul><li><strong>早期DBMS和数据库应用程序结合在同一个程序中.应用程序直接操作数据库文件</strong></li></ul></li><li>两层<ul><li><strong>将DBMS和数据库应用程序分开，在客户端上运行服务，如访问规则、业务规则、合法性校验等。每个客户端与数据库服务器建立独立连接</strong></li></ul></li><li>三层（多层）<ul><li><strong>把客户机和数据库服务分开，利用中间层的应用服务器来处理服务</strong></li></ul></li></ul><h2 id="关系理论1"><a href="#关系理论1" class="headerlink" title="关系理论1"></a>关系理论1</h2><h3 id="数据三种描述形式"><a href="#数据三种描述形式" class="headerlink" title="数据三种描述形式"></a>数据三种描述形式</h3><ul><li>现实世界</li><li>信息世界-ER表示</li><li>机器世界-DBMS支持的数据模型</li></ul><h3 id="数据描述术语"><a href="#数据描述术语" class="headerlink" title="数据描述术语"></a>数据描述术语</h3><ul><li>信息世界<ul><li>实体</li><li>实体集</li><li>属性</li><li>实体键</li></ul></li><li>机器世界<ul><li>记录</li><li>文件</li><li>字段</li><li>记录键</li></ul></li></ul><p>上下相应位置一一对应</p><h3 id="实体-联系模型"><a href="#实体-联系模型" class="headerlink" title="实体-联系模型"></a>实体-联系模型</h3><p>E-R模型表示信息世界</p><p><img src="/imgs/databasenote/1.png" alt="image-20230628105006536"></p><p><strong>E-R图中带下划线的属性为实体键或实体键的一部分。 组合属性用一个树型表示。多值属性用虚线椭圆表示或标出</strong></p><h3 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h3><p>数据模型&#x3D;数据组织方法+数据操作集合+数据完整性集合</p><h4 id="数据组织方法"><a href="#数据组织方法" class="headerlink" title="数据组织方法"></a>数据组织方法</h4><p><img src="/imgs/databasenote/2.png" alt="image-20230628111040653"></p><p><img src="/imgs/databasenote/3.png" alt="image-20230628111109838"></p><ul><li><p>层次模型</p><p><strong>层次型数据库模型采用树状结构，依据数据的不同类型，将数据分门别类，存储在不同的层次之下</strong></p></li><li><p>网状模型</p><p><strong>网状数据库模型将每个记录当成一个节点，节点和节点之间可以建立关联，形成一个复杂的网状结构</strong></p></li><li><p>关系模型</p><p><strong>二维矩阵来存储数据，行和列形成一个关联的数据表</strong></p><p>记录和记录之间通过属性之间的关系来进行连接并形成数据集之间的关系</p></li></ul><p>DBMS：</p><blockquote><p>层次数据库系统</p><p>网状数据库系统</p><p>关系数据库系统</p></blockquote><ul><li>关系数据库的原理：关系模型和关系代数</li></ul><h3 id="关系数据模型"><a href="#关系数据模型" class="headerlink" title="关系数据模型"></a>关系数据模型</h3><h4 id="理论基础及数据结构"><a href="#理论基础及数据结构" class="headerlink" title="理论基础及数据结构"></a>理论基础及数据结构</h4><ul><li>理论基础：关系理论（关系代数）</li><li>数据结构：二维表</li></ul><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p><strong>实体和联系均用二维表来表示的数据模型称之为关系数据模型。</strong></p><h4 id="概念术语"><a href="#概念术语" class="headerlink" title="概念术语"></a>概念术语</h4><p><img src="/imgs/databasenote/4.png" alt="image-20230628112933184"></p><ul><li><p>关系模式</p><p><strong>二维表的表头那一行称为关系模式，又称表的框架或记录类型</strong></p><p><strong>关系数据模型是若干关系模式的集合</strong></p></li><li><p>关系</p><p><strong>对应于关系模式的一个具体的表称为关系，又称表（Table）</strong></p></li><li><p>元组</p><p><strong>关系中的每一行称为关系的一个元组，又称行（Row）或记录</strong></p></li><li><p>属性</p><p><strong>关系中的每一列称为关系的一个属性，又称列（Column）</strong></p></li><li><p>变域</p><p><strong>关系中的每一属性所对应的取值范围叫属性的变域，简称域</strong></p><p><strong>域是值的集合，关系中所有属性的实际值均来自它所对应的域</strong></p></li><li><p>关键字</p><p><strong>如果关系模式中的某个或某几个属性组成的属性{Ai1,Ai2,…Ain}(n&gt;&#x3D;1)能唯一地标识对应于该关系模式的关系中的任何一个元组，我们就称这样的属性组为该关系模式及其对应关系的关键字(Key)</strong></p></li><li><p>候选关键字</p><p><strong>如果在一个关系中，存在多个属性或属性组合都能用来唯一表示该关系的元组，这些属性或属性 组合都称为该关系的候选关键字或候选码</strong></p></li><li><p>主关键字</p><p><strong>若干个侯选关键字中指定作为关键字的属性或属性组合</strong></p></li><li><p>外部关键字</p><p><strong>当关系中的某个属性或属性组合随不是该关系的关键字或只是关键字的一部分,但却是另一个关系的关键字时,称该属性或属性组合为这个关系的外部关键字或外键</strong></p><p><strong>主表与从表：主表和从表是指以外键相关连的两个表,以外键作为主键的表称为主表;外键所在的表称为从表</strong></p></li></ul><h4 id="关系数据模型完整性约束"><a href="#关系数据模型完整性约束" class="headerlink" title="关系数据模型完整性约束"></a>关系数据模型完整性约束</h4><ul><li>域完整性</li><li>实体完整性</li><li>引用&#x2F;参考完整性</li><li>用户自定义完整性</li></ul><h4 id="关系数据模型的数据操作"><a href="#关系数据模型的数据操作" class="headerlink" title="关系数据模型的数据操作"></a>关系数据模型的数据操作</h4><p>增删查改</p><h4 id="E-R模型转化成关系数据模型"><a href="#E-R模型转化成关系数据模型" class="headerlink" title="E-R模型转化成关系数据模型"></a>E-R模型转化成关系数据模型</h4><ul><li><p><strong>每个实体类型转化为一个关系模式实体类型中实体的属性转化为该关系模式的属性；实体标识符（实体键）转化为该关系模式的关键字；每一个实体转化为该关系模式对应关系的一个元组</strong></p></li><li><p><strong>实体类型间的每一个自身有属性的联系转化为一个关系模式。该联系的属性直接转化为该关系模式的属性，与该联系所关联的所有实体类型的实体键都转化为该关系模式的属性，共同组成该关系模式的主关键字</strong></p></li><li><p><strong>若联系自身无属性</strong></p><p><strong>对1:N型联系，则1侧实体类型的实体键转化为属性加入到N侧实体类型</strong></p><p><strong>对M:N型联系，则两侧实体类型的实体键都转化为属性，互相加入到对侧实体类型所转化后的关系模式中，和该关系模式的原主关键字一起，共同构成该关系模式新的主关键字；<em>或者建立一个新关系模式,关键字是关系的双方的主键共同组成</em></strong></p><p><strong>对1:1型联系，则按1:N型联系或M:N型联系处理</strong></p></li></ul><h2 id="关系理论2"><a href="#关系理论2" class="headerlink" title="关系理论2"></a>关系理论2</h2><p>规范化、函数依赖与范式</p><p>好的关系模式：</p><ol><li>尽可能少的数据冗余</li><li>没有插入异常</li><li>没有删除异常</li><li>没有更新异常</li></ol><h3 id="函数依赖"><a href="#函数依赖" class="headerlink" title="函数依赖"></a>函数依赖</h3><p>设R(U)是属性集U上的关系模式，X与Y是U的子集，若对于R(U)的任意一个当前值r，如果对r中的任意两个元组t和s，都有t[X]≡s[X]，就必须有t[Y] ≡s[Y](即若它们在X上的属性值相等，则在Y上的属性值也一定相等），则称“X”函数决定Y或“Y”函数依赖于X，记作X→Y，并称X为决定因素</p><ol><li>若$X \to Y$则称X为决定因素</li><li>若$X \to Y，Y \to X$，则记作$X&lt;-&gt;Y$</li><li>若Y不函数依赖于X</li></ol><h4 id="分类和键"><a href="#分类和键" class="headerlink" title="分类和键"></a>分类和键</h4><ul><li><p>平凡函数依赖、非平凡函数依赖</p><p><strong>设X,Y均为某关系上的属性集，且X→Y，则Y函数依赖于X，X函数决定Y</strong></p><p><strong>若Y包含于X，则称X→Y为：平凡函数依赖</strong></p><p><strong>若Y不包含于X，则称X→Y为：非平凡函数依赖</strong></p></li><li><p>完全函数依赖</p><p><strong>在R（U）中，如果X→Y，并且对于X的任何一个真子集X’，其X’→ Y都不成立，则称Y对X完全函数依赖</strong></p></li><li><p>部分函数依赖</p><p><strong>在R（U）中，如果X→Y，X’→Y，则称Y对X部分函数依赖</strong></p></li><li><p>传递函数依赖</p><p><strong>设有关系模式R(U)，X，Y，Z∈U，如果X→Y，Y→Z，且Y不∈X，Y不函数决定X，则有X→Z，称Z传递函数依赖于X</strong></p></li></ul><p><strong>键</strong></p><p>设K为R（U）中的属性或属性组合，若U函数依赖于K，则K为R的候选键（Candidate Key）。若候选键多于一个，则选定其中的一个为主键（Primary Key），也称为键（Key）；当只有一个候选键时这个候选键即是主键</p><ul><li><p>包含在任何一个候选键中的属性，叫主属性（Prime Attribute）。</p></li><li><p>不包含在任何主键中的属性称为非主属性（Nonprime Attribute），或非键属性（Non-key Attribute）。</p></li></ul><h3 id="范式"><a href="#范式" class="headerlink" title="范式"></a>范式</h3><h4 id="第一范式"><a href="#第一范式" class="headerlink" title="第一范式"></a>第一范式</h4><p>关系模式R的每一个属性都是不可分解的，则称R为第一范式的模式，记为R∈1FN模式</p><h4 id="第二范式"><a href="#第二范式" class="headerlink" title="第二范式"></a>第二范式</h4><p>如果R∈1NF，且每一个<strong>非主属性</strong>完全函数依赖于主键则R∈2NF</p><ul><li>从1NF关系中<strong>消除非主属性对关系键的部分函数依赖</strong>，则可得到2NF关系</li><li>如果<strong>R的关系键为单属性，或R的全体属性均为主属性，则R∈2NF</strong></li></ul><h4 id="第三范式"><a href="#第三范式" class="headerlink" title="第三范式"></a>第三范式</h4><p>如果R∈2NF，且每一个非主属性不传递函数依赖于主键，则R∈3NF</p><h4 id="BC范式"><a href="#BC范式" class="headerlink" title="BC范式"></a>BC范式</h4><p>R是一个关系模式，F是其函数依赖集合，当且仅当F中每个函数依赖的决定因素必定包含R的某个候选关键字，则R∈BCNF</p><h4 id="范式转化"><a href="#范式转化" class="headerlink" title="范式转化"></a>范式转化</h4><blockquote><p>1NF（存在非主属性对主键的部分函数依赖）</p><p>I</p><p>I消除非主属性对主键的部分函数依赖</p><p>I</p><p>v</p><p>2NF（存在非主属性对主键的传递函数依赖）</p><p>I</p><p>I消除非主属性对主键的传递函数依赖</p><p>I</p><p>v</p><p>3NF</p><p>I</p><p>I消除主属性对主键的部分函数依赖和传递函数依赖</p><p>I</p><p>v</p><p>BCNF</p></blockquote><h4 id="判断范式类型"><a href="#判断范式类型" class="headerlink" title="判断范式类型"></a>判断范式类型</h4><ul><li><p>第一范式：存在部分函数依赖</p></li><li><p>第二范式：</p><ol><li>主键是单属性</li><li>不存在部分函数依赖</li><li>存在传递依赖</li></ol></li><li><p>第三范式：</p><p>不是第一范式、第二范式</p></li></ul><h4 id="判断候选码"><a href="#判断候选码" class="headerlink" title="判断候选码"></a>判断候选码</h4><ul><li>如果有属性不在函数依赖集中出现，那么它必须包含在候选码中</li><li>如果有属性只在函数依赖集的右边出现，那么它必须不在候选码中</li><li>如果有属性只在函数依赖集的左边出现，则该属性一定包含在候选码中</li><li>如果有属性或属性组能唯一标识元组，则它就是候选码；（也就是说，<strong>通过函数依赖推导出，某属性或属性组，能决定所有属性</strong>）（也就是说，<strong>通过函数依赖推导出，某属性或属性组的闭包中有所有属性</strong>）</li></ul><h4 id="2NF分解"><a href="#2NF分解" class="headerlink" title="2NF分解"></a>2NF分解</h4><p><img src="/imgs/databasenote/5.png" alt="image-20230628151227821"></p><h4 id="3NF分解"><a href="#3NF分解" class="headerlink" title="3NF分解"></a>3NF分解</h4><p><img src="/imgs/databasenote/6.png" alt="image-20230628151853779"></p><p>（2）中改成3NF</p><h4 id="求最小函数依赖集合"><a href="#求最小函数依赖集合" class="headerlink" title="求最小函数依赖集合"></a>求最小函数依赖集合</h4><p><img src="/imgs/databasenote/7.png" alt="image-20230628153356995"></p><p><img src="/imgs/databasenote/8.png" alt="image-20230628153428834"></p><p><img src="/imgs/databasenote/9.png" alt="image-20230628153454936"></p><p><a href="https://blog.csdn.net/mgsky1/article/details/89061365">关系数据库理论之最小函数依赖集</a></p><h2 id="使用SQL-server管理数据库"><a href="#使用SQL-server管理数据库" class="headerlink" title="使用SQL server管理数据库"></a>使用SQL server管理数据库</h2><h3 id="数据库存储结构"><a href="#数据库存储结构" class="headerlink" title="数据库存储结构"></a>数据库存储结构</h3><h4 id="数据库文件"><a href="#数据库文件" class="headerlink" title="数据库文件"></a>数据库文件</h4><p><strong>一个数据库创建在物理介质（如硬盘）的一个或多个文件上，这些文件包括数据库中的对象和数据，或者事务日志的信息</strong></p><ul><li>存储数据的文件叫数据文件</li><li>存储日志的文件叫日志文件</li></ul><p><strong>数据和日志信息不存储在同一个文件中；不同数据库的数据也不存储在同一个文件中</strong></p><p><strong>数据库文件满时，它们可以自动增长</strong></p><p>SQL server中三种类型数据库文件</p><ul><li>主数据库文件（.mdf）<strong>不仅包含数据库用户收集的信息，还包含了数据库中所有其他文件的有关信息</strong></li><li>辅数据库文件（.ndf）</li><li>日志文件（.ldf）</li></ul><h4 id="数据库文件组"><a href="#数据库文件组" class="headerlink" title="数据库文件组"></a>数据库文件组</h4><p><strong>文件组就是文件的集合，把一些分别放在多个磁盘中的文件组合在一起，方便管理和数据分配，可以提高数据库性能</strong></p><p>三种类型的文件组</p><ul><li>主文件组</li><li>用户定义型文件组</li><li>缺省的文件组</li></ul><p>建立文件组的规则</p><ul><li><strong>数据库文件不能与一个以上的文件组关联</strong></li><li><strong>文件和文件组也不能由多个数据库使用</strong></li><li><strong>日志文件不能加到文件组里。日志数据与数据库数据的管理方式不同</strong></li><li><strong>只有文件组中任何一个文件都没有空间了，文件组的文件才会自动增长</strong></li></ul><h4 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h4><p><strong>SQL Server中的所有信息都存储在页面（page）上，页面是数据库中使用的最小数据单元</strong></p><p>每一个页面存储8KB（8192字节）的信息，所有的页面都包括一个132字节的页面头，这样就留下了8060 字节存储数据</p><p>页面类型：</p><ul><li>分配页面</li><li>数据和日志页面</li><li>索引页面</li><li>分发页面</li><li>文本&#x2F;图像页面</li></ul><h4 id="盘区"><a href="#盘区" class="headerlink" title="盘区"></a>盘区</h4><p><strong>盘区是表和索引等数据库对象分配空间的单位</strong></p><p>一个盘区（extent）是由8个连续的页面（8×8KB &#x3D; 64KB）组成的数据结构</p><p>当创建一个数据库对象（如一个表）时， SQL Server会自动地以盘区为单位给它分配空间</p><h4 id="事务日志"><a href="#事务日志" class="headerlink" title="事务日志"></a>事务日志</h4><p><strong>当一个事务开始后，在任何实际数据修改前，都会在事务日志中写入一行，表明事务开始。任何改动都会被记入事务日志</strong></p><p><img src="/imgs/databasenote/10.png" alt="image-20230628161258336"></p><h3 id="系统数据库"><a href="#系统数据库" class="headerlink" title="系统数据库"></a>系统数据库</h3><p><strong>SQL Server安装4个系统数据库。它们分别是master数据库、model数据库、tempdb数据库和msdb数据库</strong></p><h4 id="master数据库"><a href="#master数据库" class="headerlink" title="master数据库"></a>master数据库</h4><p>控制SQL Server的所有方面。这个数据库中包括所有的配置信息、用户登录信息、当前正在服务器中运行的过程的信息</p><p><strong>SQL Server运行时所做的第一件事就是寻找master数据库并打开它</strong></p><h4 id="model数据库"><a href="#model数据库" class="headerlink" title="model数据库"></a>model数据库</h4><p>model数据库是建立所有用户数据库时的模板。当你建立一个新数据库时， SQL Server会把model数据库中的<strong>所有对象建立一份拷贝并移到新数据库</strong>中</p><p><strong>对model所作的每一个动作都在新数据库中产生影响</strong></p><h4 id="tempdb数据库"><a href="#tempdb数据库" class="headerlink" title="tempdb数据库"></a>tempdb数据库</h4><p>tempdb数据库是一个非常特殊的数据库，供所有来访问你的SQL Server的用户使用。这个库用来<strong>保存所有的临时表、存储过程和其他SQL Server建立的临时用的东西</strong></p><p>每次SQL Server重新启动，它都会清空tempdb数据库并重建。永远不要在tempdb数据库建立需要永久保存的表</p><h4 id="msdb数据库"><a href="#msdb数据库" class="headerlink" title="msdb数据库"></a>msdb数据库</h4><p>msdb数据库是SQL Server中的一个特例。如果你查看这个数据库的实际定义，会发现它其实是一个用户数据库。不同之处是SQL Server拿这个数据库来做什么。</p><p>所有的任务调度、报警、操作员都存储在msdb数据库中。</p><p>该库的另一个功能是用来存储所有备份历史。</p><p>SQL Server Agent将会使用这个库</p><h3 id="用户数据库"><a href="#用户数据库" class="headerlink" title="用户数据库"></a>用户数据库</h3><p><strong>自己建立的新数据库都是用户数据库</strong></p><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><h3 id="修改数据库"><a href="#修改数据库" class="headerlink" title="修改数据库"></a>修改数据库</h3><h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><h3 id="数据库的空间需求"><a href="#数据库的空间需求" class="headerlink" title="数据库的空间需求"></a>数据库的空间需求</h3><h3 id="压缩数据库"><a href="#压缩数据库" class="headerlink" title="压缩数据库"></a>压缩数据库</h3><h2 id="使用SQL-server管理表"><a href="#使用SQL-server管理表" class="headerlink" title="使用SQL server管理表"></a>使用SQL server管理表</h2><h3 id="表的定义"><a href="#表的定义" class="headerlink" title="表的定义"></a>表的定义</h3><p><strong>表是一种二维数据对象，是列的相似数据的集合。表由行和列组成，用于存储关系数据库中的数据，是数据库中的主要对象</strong></p><p><strong>表中的行又叫记录，代表单个实体的有关数据的集合</strong></p><p><strong>表中的每行可以分成许多列。列代表记录中的一个信息片段</strong></p><h3 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h3><p>标识符的命名规则：</p><p>标识符的长度必须少于等于128字符。</p><p>标识符的第一个字符必须是字母(A<del>Z、a</del>z)、_ (下划线)、@或#</p><p>当一个对象以@符号开头，意味着它是一个局部变量。</p><p>以#符号开头的对象表示它是一个局部临时表或是存储过程。</p><p>以# #开头的对象是全局临时对象</p><p>SQL Server有许多以@@开头的函数。不要用@@作为任何对象名的开头</p><p>虽然中文或其他国家语言的字符也可以作为标示符，但是不推荐这么用</p><p>跟在首字符后面的字符可以是字母(A<del>Z、a</del>z以及其他语言的任何字母符号)、_ (下划线)、@或#，数字( 0~9以及其他语言的任何其他数字符号)、$ (美元符)、# 。</p><p>SQL Server保留字(诸如命令字)不允许用。</p><p>空格或其他特殊字符不能在标识符中使用。</p><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><h3 id="空值"><a href="#空值" class="headerlink" title="空值"></a>空值</h3><h3 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h3><h3 id="主键和UNIQUE约束"><a href="#主键和UNIQUE约束" class="headerlink" title="主键和UNIQUE约束"></a>主键和UNIQUE约束</h3><p><strong>强制唯一性时应用UNIQUE约束而不是主键</strong></p><h3 id="递增值"><a href="#递增值" class="headerlink" title="递增值"></a>递增值</h3><p>标识列，<strong>可以通过向列定义添加Identity属性来将某一列指定为递增值的列</strong></p><p><strong>一个表中只能有一个标识列，标识列可以作主键，标识列不能自己修改，标识列是非空的。可以看做一个特殊的递增的每行都不同的默认值</strong></p><h3 id="创建表、修改表、删除表"><a href="#创建表、修改表、删除表" class="headerlink" title="创建表、修改表、删除表"></a>创建表、修改表、删除表</h3><h3 id="CHECK约束、规则"><a href="#CHECK约束、规则" class="headerlink" title="CHECK约束、规则"></a>CHECK约束、规则</h3><p><strong>语法：名字＋逻辑表达式＋列名</strong></p><p><strong>一个列只能应用一个规则，但是却可以应用多个</strong> <strong>CHECK</strong> <strong>约束</strong></p><h3 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h3><p>外键 (FK) 是用于建立和加强两个表数据之间的链接的一列或多列。通过将表中主键值和Unique约束的一列或多列添加到另一个表中，可创建两个表之间的链接。这个列就成为第二个表的外键</p><h3 id="数据完整性"><a href="#数据完整性" class="headerlink" title="数据完整性"></a>数据完整性</h3><ul><li><p>域完整性</p><p>默认值、空值、CHECK约束、规则</p></li><li><p>实体完整性</p><p>主键，UNIQUE键</p></li><li><p>参考完整性</p><p>外键</p></li><li><p>用户定义完整性</p><p>触发器、存储过程</p></li></ul><h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><p><strong>SQL的组成</strong></p><ul><li><p>DDL</p><p>Create（Alter、Drop）数据库、表、视图、规则、存储过程、触发器等</p></li><li><p>DML</p><p>Insert，Delete，Update，Select 数据库中的信息</p></li><li><p>DCL</p><p>对各种数据库对象设置权限</p></li><li><p>ALE</p></li></ul><h2 id="SQL-SELECT"><a href="#SQL-SELECT" class="headerlink" title="SQL-SELECT"></a>SQL-SELECT</h2><h3 id="SELECT-and-FROM-and-INTO"><a href="#SELECT-and-FROM-and-INTO" class="headerlink" title="SELECT and FROM and INTO"></a>SELECT and FROM and INTO</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token keyword">SELECT</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span>注意要用哪个数据库，要在界面上选中，这样才方便查询库中表<span class="token comment">----------------1.SELECT and FROM 子句------------------</span><span class="token keyword">SELECT</span> 子句，用来控制列，说明那些列在查询结果里面<span class="token keyword">FROM</span>   子句，用来控制表，说明在哪个<span class="token operator">/</span>哪些表里面查询<span class="token comment">--*代表所有列</span><span class="token keyword">SELECT</span> <span class="token operator">*</span>     <span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> publishers<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> authors<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titleauthor<span class="token comment">--控制显示的列</span><span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price <span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> au_lname<span class="token punctuation">,</span> au_fname<span class="token keyword">FROM</span> authors<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> title<span class="token punctuation">,</span> price <span class="token keyword">FROM</span> titles<span class="token comment">--列的别名</span><span class="token keyword">SELECT</span> title <span class="token keyword">as</span> <span class="token string">'title-1'</span><span class="token punctuation">,</span> title <span class="token keyword">as</span> <span class="token string">'title-2'</span><span class="token punctuation">,</span> price<span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> title <span class="token keyword">as</span> <span class="token string">'书名1'</span><span class="token punctuation">,</span> title <span class="token keyword">as</span> <span class="token string">'书名2'</span><span class="token punctuation">,</span> price <span class="token keyword">as</span> <span class="token string">'单价'</span><span class="token keyword">FROM</span> titles<span class="token comment">--常数列</span><span class="token keyword">SELECT</span> <span class="token string">'我'</span> <span class="token keyword">as</span> <span class="token string">'常数列'</span><span class="token keyword">SELECT</span> <span class="token string">'我'</span> <span class="token keyword">as</span> <span class="token string">'常数列'</span><span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> <span class="token string">'单价是：'</span><span class="token punctuation">,</span> price<span class="token keyword">FROM</span> titles<span class="token comment">--运算列</span><span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price <span class="token operator">*</span> <span class="token number">0.9</span> <span class="token keyword">as</span> <span class="token string">'单价九折'</span><span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price <span class="token keyword">as</span> <span class="token string">'原价'</span><span class="token punctuation">,</span> price <span class="token operator">*</span> <span class="token number">0.9</span> <span class="token keyword">as</span> <span class="token string">'九折价'</span><span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price <span class="token keyword">as</span> <span class="token string">'原价'</span><span class="token punctuation">,</span> <span class="token string">'九折'</span> <span class="token keyword">as</span> <span class="token string">'折扣力度'</span><span class="token punctuation">,</span> price <span class="token operator">*</span> <span class="token number">0.9</span> <span class="token keyword">as</span> <span class="token string">'折后价'</span><span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price <span class="token operator">*</span> ytd_sales <span class="token keyword">as</span> <span class="token string">'总销售额'</span><span class="token keyword">FROM</span> titles<span class="token comment">--列的拼接</span><span class="token keyword">SELECT</span> au_lname<span class="token punctuation">,</span> au_fname<span class="token keyword">FROM</span> authors<span class="token keyword">SELECT</span> au_lname <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> au_fname <span class="token keyword">as</span> <span class="token string">'作者姓名'</span><span class="token keyword">FROM</span> authors<span class="token keyword">SELECT</span> au_lname <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> au_fname <span class="token operator">+</span> <span class="token string">' 住在: '</span> <span class="token operator">+</span> city <span class="token keyword">as</span> <span class="token string">'一句话'</span><span class="token keyword">FROM</span> authors<span class="token comment">--重要语法：DISTINCT</span><span class="token keyword">SELECT</span> <span class="token keyword">type</span> <span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> <span class="token keyword">type</span> <span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> pub_id<span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> pub_id<span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token keyword">FROM</span> titles<span class="token comment">--重要语法：TOP n</span><span class="token keyword">SELECT</span> <span class="token keyword">TOP</span> <span class="token number">3</span> title<span class="token punctuation">,</span> price<span class="token keyword">FROM</span> titles<span class="token comment">-------------------------2. INTO 子句---------------</span><span class="token keyword">INTO</span> 子句，把一个查询结果，直接创建一个新表，存起来<span class="token keyword">SELECT</span> <span class="token keyword">TOP</span> <span class="token number">3</span> title<span class="token punctuation">,</span> price<span class="token keyword">INTO</span> titles3rows<span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles3rows<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token keyword">SELECT</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token comment">----------------3.WHERE 子句------------------</span><span class="token keyword">WHERE</span> 子句用来控制行，做条件判断，符合条件的就显示出来<span class="token number">1.</span> <span class="token operator">=</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> pub_id <span class="token operator">=</span> <span class="token number">1389</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> pub_id <span class="token operator">=</span> <span class="token number">1111</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> price <span class="token operator">=</span> <span class="token number">19.99</span><span class="token number">2.</span><span class="token operator">&lt;></span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> price <span class="token operator">&lt;></span> <span class="token number">19.99</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">&lt;></span> <span class="token string">'business'</span><span class="token number">3.</span> <span class="token operator">></span> <span class="token operator">&lt;</span>  <span class="token operator">>=</span>  <span class="token operator">&lt;=</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> price <span class="token operator">></span> <span class="token number">19</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">></span> <span class="token string">'zusiness'</span><span class="token number">4.</span> <span class="token operator">and</span> <span class="token operator">or</span> <span class="token operator">not</span> 与或非<span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token operator">not</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span> <span class="token operator">and</span> price <span class="token operator">></span> <span class="token number">9</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span> <span class="token operator">or</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'mod_cook'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span> <span class="token operator">or</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'mod_cook'</span> <span class="token operator">and</span> price <span class="token operator">></span> <span class="token number">19</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span> <span class="token operator">or</span> <span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'mod_cook'</span> <span class="token operator">and</span> price <span class="token operator">></span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span> <span class="token operator">or</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'mod_cook'</span><span class="token punctuation">)</span> <span class="token operator">and</span> price <span class="token operator">></span> <span class="token number">19</span><span class="token number">5.</span> <span class="token operator">between</span> <span class="token operator">and</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> price <span class="token operator">between</span> <span class="token number">10</span> <span class="token operator">and</span> <span class="token number">19</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> price <span class="token operator">>=</span> <span class="token number">9</span> <span class="token operator">and</span> price <span class="token operator">&lt;=</span> <span class="token number">19</span><span class="token number">6.</span> <span class="token operator">is</span> <span class="token boolean">null</span>  <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> price <span class="token operator">is</span> <span class="token boolean">null</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> price <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token number">7.</span>多值条件 <span class="token operator">in</span>  <span class="token operator">not</span> <span class="token operator">in</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'business'</span><span class="token punctuation">,</span> <span class="token string">'mod_cook'</span><span class="token punctuation">,</span> <span class="token string">'popular_comp'</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span> <span class="token operator">or</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'mod_cook'</span> <span class="token operator">or</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'popular_comp'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'business'</span><span class="token punctuation">,</span> <span class="token string">'mod_cook'</span><span class="token punctuation">,</span> <span class="token string">'popular_comp'</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> price <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">9.9</span><span class="token punctuation">,</span> <span class="token number">19.99</span><span class="token punctuation">,</span> <span class="token number">29.99</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2.99</span><span class="token punctuation">)</span><span class="token number">8.</span>模糊查询<span class="token number">8.1</span> <span class="token operator">like</span> <span class="token string">'%xxxxxxx%'</span>   其中<span class="token operator">%</span>叫做通配符，而且是无关长度的通配<span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> title <span class="token operator">like</span> <span class="token string">'%computer%'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> title <span class="token operator">like</span> <span class="token string">'%comp%'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> title <span class="token operator">like</span> <span class="token string">'comp%'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> title <span class="token operator">like</span> <span class="token string">'%Y'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> title <span class="token operator">not</span> <span class="token operator">like</span> <span class="token string">'%computer%'</span><span class="token number">8.2</span>  _  单字符统配<span class="token keyword">SELECT</span> au_lname<span class="token punctuation">,</span> phone<span class="token keyword">FROM</span> authors<span class="token keyword">WHERE</span> phone <span class="token operator">like</span> <span class="token string">'_15%2'</span><span class="token keyword">SELECT</span> au_fname<span class="token punctuation">,</span> phone<span class="token keyword">FROM</span> authors<span class="token keyword">WHERE</span> au_fname <span class="token operator">like</span> <span class="token string">'_her__'</span><span class="token number">8.3</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> 区间单字符统配<span class="token keyword">SELECT</span> au_fname<span class="token punctuation">,</span> phone<span class="token keyword">FROM</span> authors<span class="token keyword">WHERE</span> au_fname <span class="token operator">like</span> <span class="token string">'[a-c]heryl'</span><span class="token keyword">SELECT</span> au_fname<span class="token punctuation">,</span> phone<span class="token keyword">FROM</span> authors<span class="token keyword">WHERE</span> au_fname <span class="token operator">like</span> <span class="token string">'[a-s]heryl'</span><span class="token keyword">SELECT</span> au_fname<span class="token punctuation">,</span> phone<span class="token keyword">FROM</span> authors<span class="token keyword">WHERE</span> au_fname <span class="token operator">like</span> <span class="token string">'[^a-c]heryl'</span><span class="token comment">------------------练习--------------</span>查询产品类别CategoryID是<span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span>的所有产品用多种方法来实现：<span class="token operator">OR</span>，<span class="token operator">BETWEEN</span>，<span class="token operator">IN</span>，<span class="token operator">&lt;></span><span class="token keyword">USE</span> Northwind<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> products<span class="token keyword">WHERE</span> CategoryID <span class="token operator">between</span> <span class="token number">2</span> <span class="token operator">and</span> <span class="token number">4</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> products<span class="token keyword">WHERE</span> CategoryID <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>查询产品类别是<span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span>，并且供应商SupplierID不是<span class="token number">11</span>的所有产品<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> products<span class="token keyword">WHERE</span> CategoryID <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">and</span> SupplierID <span class="token operator">&lt;></span> <span class="token number">11</span>查产品名ProduceName中以“C”或“D”或“E”开头的所有产品也可以用多种方法实现，练习使用<span class="token operator">LIKE</span>的模糊匹配<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> products<span class="token keyword">WHERE</span> ProductName <span class="token operator">like</span> <span class="token string">'[c-e]%'</span>查询库存UnitsInStock<span class="token operator">&lt;</span>订货量UnitsOnOrder的产品，并且在第一列添加常数“需要进货”<span class="token keyword">SELECT</span> <span class="token string">'需要进货'</span> <span class="token keyword">as</span> <span class="token string">'提醒'</span><span class="token punctuation">,</span> productname<span class="token punctuation">,</span> unitsinstock<span class="token punctuation">,</span> unitsonorder<span class="token keyword">FROM</span> products<span class="token keyword">WHERE</span> unitsinstock <span class="token operator">&lt;</span> unitsonorder在上面的基础上，计算出每个产品进货的预算总额利用表达式，计算出订货和库存的差距，并利用产品单价UnitPrice得出预算。需要添加一个新的计算结果的列，叫做“进货预算”<span class="token keyword">SELECT</span> <span class="token string">'需要进货'</span> <span class="token keyword">as</span> <span class="token string">'提醒'</span><span class="token punctuation">,</span> productname<span class="token punctuation">,</span>        unitsinstock<span class="token punctuation">,</span> unitsonorder<span class="token punctuation">,</span> UnitPrice<span class="token punctuation">,</span>   <span class="token punctuation">(</span>unitsonorder <span class="token operator">-</span> unitsinstock<span class="token punctuation">)</span><span class="token operator">*</span>unitprice <span class="token keyword">as</span> <span class="token string">'进货预算'</span><span class="token keyword">FROM</span> products<span class="token keyword">WHERE</span> unitsinstock <span class="token operator">&lt;</span> unitsonorder练习查找雇员表中<span class="token number">60</span>年代出生在UK的员工日期列用法例子: Birthday <span class="token operator">></span> ‘<span class="token number">2000</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span>’<span class="token keyword">SELECT</span> lastname<span class="token punctuation">,</span> firstname<span class="token punctuation">,</span> BirthDate<span class="token punctuation">,</span> Country<span class="token keyword">FROM</span> Employees<span class="token keyword">WHERE</span> birthdate <span class="token operator">between</span> <span class="token string">'1960-1-1'</span> <span class="token operator">and</span> <span class="token string">'1969-12-31'</span>       <span class="token operator">and</span> Country <span class="token operator">=</span> <span class="token string">'UK'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token keyword">SELECT</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token comment">----------------聚合函数------------------</span>MAX 最大值MIN 最小值AVG 平均值SUM 求和值COUNT 计数<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> price <span class="token operator">></span> <span class="token number">100</span><span class="token keyword">SELECT</span> <span class="token function">max</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'max'</span><span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'min'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> <span class="token function">max</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'max'</span><span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'min'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span><span class="token keyword">SELECT</span> <span class="token function">max</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span><span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span><span class="token keyword">FROM</span> titles<span class="token comment">----------------GROUP BY 子句------------------</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 子句，进行分组聚合<span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'popular_comp'</span><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'mod_cook'</span><span class="token keyword">SELECT</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">type</span><span class="token comment">--消息 8120，级别 16，状态 1，第 1 行</span>选择列表中的列 <span class="token string">'titles.type'</span> 无效，因为该列没有包含在聚合函数或 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 子句中。！！！！！<span class="token keyword">group</span> <span class="token keyword">by</span>出现的情况下，<span class="token keyword">select</span>里面的列，要不就是出现在<span class="token keyword">group</span> <span class="token keyword">by</span>中，要不就必须在聚合函数中<span class="token keyword">SELECT</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> pub_id<span class="token keyword">SELECT</span> pub_id<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> pub_id<span class="token comment">-------Group by 的多列，嵌套使用</span><span class="token keyword">SELECT</span> <span class="token keyword">type</span><span class="token punctuation">,</span> pub_id<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">type</span><span class="token punctuation">,</span> pub_id<span class="token keyword">SELECT</span> <span class="token keyword">type</span><span class="token punctuation">,</span> pub_id<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> price <span class="token operator">></span> <span class="token number">20</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">type</span><span class="token punctuation">,</span> pub_id<span class="token comment">------------------------HAVING 子句----------------</span><span class="token keyword">HAVING</span> 子句，负责对聚合函数的结果进行条件判断，符合条件的显示<span class="token keyword">SELECT</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10000</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">type</span><span class="token comment">--消息 147，级别 15，状态 1，第 3 行</span>聚合不应出现在 <span class="token keyword">WHERE</span> 子句中，除非该聚合位于 <span class="token keyword">HAVING</span> 子句或选择列表所包含的子查询中，并且要对其进行聚合的列是外部引用。<span class="token keyword">SELECT</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">type</span><span class="token keyword">HAVING</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10000</span> <span class="token keyword">SELECT</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">type</span><span class="token keyword">HAVING</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10000</span> <span class="token operator">and</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token keyword">SELECT</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> pub_id <span class="token operator">=</span> <span class="token number">1389</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">type</span><span class="token keyword">HAVING</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10000</span><span class="token keyword">SELECT</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> price <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">type</span><span class="token keyword">HAVING</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10000</span><span class="token comment">-----------------------------------ORDER BY-------------------------------</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 子句，根据某列的值，对查询结果进行排序<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> ytd_sales<span class="token keyword">FROM</span> titles<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> ytd_sales<span class="token keyword">FROM</span> titles<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">ASC</span>   默认升序<span class="token keyword">ASC</span>关键词可以不写<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> ytd_sales<span class="token keyword">FROM</span> titles<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> ytd_sales<span class="token keyword">FROM</span> titles<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pub_id<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> ytd_sales<span class="token keyword">FROM</span> titles<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price<span class="token punctuation">,</span> ytd_sales <span class="token keyword">DESC</span><span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> ytd_sales<span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> pub_id <span class="token operator">=</span> <span class="token number">1389</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price<span class="token punctuation">,</span> ytd_sales <span class="token keyword">DESC</span><span class="token keyword">SELECT</span> <span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'avg'</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> pub_id <span class="token operator">=</span> <span class="token number">1389</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">type</span><span class="token keyword">HAVING</span> <span class="token function">sum</span><span class="token punctuation">(</span>ytd_sales<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10000</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">avg</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">DESC</span><span class="token comment">---------------</span>显示单价最高的<span class="token number">10</span>个商品需要先按降序排列，然后取<span class="token keyword">TOP</span> <span class="token number">10</span>计算所有商品的总单价统计类型为<span class="token number">1</span>的商品的个数，和总库存在作聚合函数的时候要选择<span class="token number">2</span>个聚合函数，而且要添加<span class="token keyword">WHERE</span>条件<span class="token keyword">SELECT</span> <span class="token keyword">TOP</span> <span class="token number">10</span> productname<span class="token punctuation">,</span> CategoryID<span class="token punctuation">,</span>  unitprice<span class="token keyword">FROM</span> products<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> unitprice <span class="token keyword">DESC</span><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>unitprice<span class="token punctuation">)</span><span class="token keyword">FROM</span> products<span class="token keyword">SELECT</span>  <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>unitsinstock<span class="token punctuation">)</span><span class="token keyword">FROM</span> products<span class="token keyword">WHERE</span> Categoryid <span class="token operator">=</span> <span class="token number">1</span>统计当前有多少个供应商给我们供货要求只显示出供应商的SupplierID就可以了<span class="token number">2</span>方法，<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>，<span class="token keyword">DISTINCT</span>统计每个供应商ID提供的商品个数按供应商ID分组，并添加聚合函数按商品个数的升序排列刚才的结果添加对聚合函数的结果的排序只显示提供商品个数<span class="token operator">></span><span class="token number">3</span>的供应商使用<span class="token keyword">Having</span>子句<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> SupplierID<span class="token keyword">FROM</span> products<span class="token keyword">SELECT</span>  SupplierID<span class="token keyword">FROM</span> products<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> SupplierID<span class="token keyword">SELECT</span>  SupplierID<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">FROM</span> products<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> SupplierID<span class="token keyword">HAVING</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">3</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h3><pre class="line-numbers language-cql" data-language="cql"><code class="language-cql">---------------------------多表查询--------------------------------方法一：用where中&#x3D;来连接两个表--------------SELECT * FROM titlesSELECT * FROM publishers查询这个出版社 New Moon Books 出版的所有书SELECT * FROM publishersWHERE pub_name &#x3D; &#39;New Moon Books&#39;SELECT * FROM titlesWHERE pub_id &#x3D; 0736SELECT *FROM titles, publishersORDER BY title_id返回了144行 &#x3D; 18*8titles表里面的pub_id是外键，他来自publishers表里面的主键pub_idSELECT title_id, title, price, titles.pub_id, publishers.pub_id, pub_nameFROM titles, publishersORDER BY title_idSELECT title_id, title, price, titles.pub_id, publishers.pub_id, pub_nameFROM titles, publishersWHERE titles.pub_id &#x3D; publishers.pub_idORDER BY title_idSELECT title, price, pub_nameFROM titles, publishersWHERE titles.pub_id &#x3D; publishers.pub_idORDER BY priceSELECT title, price, pub_nameFROM titles, publishersWHERE titles.pub_id &#x3D; publishers.pub_id       and pub_name &#x3D;&#39;New Moon Books&#39;ORDER BY priceSELECT * FROM Employee （job——id）SELECT * FROM jobs （job_desc）显示每个雇员的名字和职位描述SELECT e.lname, j.job_descFROM employee as e, jobs as jWHERE e.job_id &#x3D; j.job_idSELECT * FROM titlesSELECT * FROM authorsSELECT * FROM titleauthorSELECT title, au_fname, au_lname, au_ordFROM titleauthor as ta, titles as t, authors as aWHERE ta.au_id &#x3D; a.au_id and ta.title_id &#x3D; t.title_idORDER BY title, au_ordSELECT title, au_fname, au_lname, au_ordFROM titleauthor as ta, titles as t, authors as aWHERE ta.au_id &#x3D; a.au_id and ta.title_id &#x3D; t.title_id and a.state &#x3D; &#39;CA&#39;ORDER BY title, au_ord思考：再加一列，出版社的名字，咋办？SELECT title, au_fname, au_lname, au_ord, pub_nameFROM titleauthor as ta, titles as t, authors as a, publishers as pWHERE ta.au_id &#x3D; a.au_id and ta.title_id &#x3D; t.title_id and p.pub_id &#x3D; t.pub_idORDER BY title, au_ord思考: 查询，作者，和，出版社，都在同一个省的，书SELECT title, au_fname, au_lname, au_ord, pub_nameFROM titleauthor as ta, titles as t, authors as a, publishers as pWHERE ta.au_id &#x3D; a.au_id and ta.title_id &#x3D; t.title_id and p.pub_id &#x3D; t.pub_id      and p.state &#x3D; a.stateORDER BY title, au_ord----------方法二：用where中的子查询--------------我们要查找出版过商业书籍的，出版社编号和名字SELECT DISTINCT publishers.pub_id, publishers.pub_nameFROM titles, publishersWHERE titles.pub_id &#x3D; publishers.pub_id     and titles.type &#x3D; &#39;business&#39;SELECT publishers.pub_id, publishers.pub_nameFROM titles, publishersWHERE titles.pub_id &#x3D; publishers.pub_id     and titles.type &#x3D; &#39;business&#39;SELECT publishers.pub_id, publishers.pub_nameFROM publishersWHERE publishers.pub_id in(   SELECT pub_id FROM titles   WHERE type &#x3D; &#39;business&#39;)SELECT publishers.pub_id, publishers.pub_nameFROM publishersWHERE publishers.pub_id in (1389,0736)地点是加州CA的出版社，出版的书，的名字和价格SELECT title, priceFROM titles WHERE pub_id in (    SELECT pub_id FROM publishersWHERE state &#x3D; &#39;CA&#39;)有两个及以上作者的，书的，名字，单价，出版社名字SELECT t.title, t.price, p.pub_nameFROM titles as t, publishers as pWHERE t.pub_id &#x3D; p.pub_id       and title_id in   (SELECT title_idFROM titleauthorGROUP BY title_idHAVING count(*) &gt;&#x3D; 2      )SELECT DISTINCT title_id FROM titleauthorWHERE au_ord &gt;&#x3D; 2SELECT title_idFROM titleauthorGROUP BY title_idHAVING count(*) &gt;&#x3D; 2找出在1996-7-1到1996-7-10期间有过销售记录的美国员工的名字SELECT lastname, firstname FROM EmployeesWHERE country &#x3D; &#39;USA&#39;      and EmployeeID in (SELECT employeeID FROM ordersWHERE orderdate between &#39;1996-7-1&#39; and &#39;1996-7-10&#39;)SELECT DISTINCT lastname, firstname FROM Employees as e, orders as oWHERE e.EmployeeID &#x3D; o.employeeID and e.country &#x3D; &#39;USA&#39; and      o.orderdate between &#39;1996-7-1&#39; and &#39;1996-7-10&#39;----------方法三：联接查询--------------SELECT * FROM titles  -18行SELECT * FROM publishers -8行SELECT * FROM titles, publishers  order by title_id    -144&#x3D;18*8交叉联接SELECT * FROM titles, publishers SELECT * FROM titles cross join publishers 内联接SELECT * FROM titles as t, publishers as pWHERE t.pub_id  &#x3D; p.pub_idSELECT * FROM titles as t inner join publishers as pon (t.pub_id &#x3D; p.pub_id)SELECT t.title, a.au_fname, a.au_fnameFROM titleauthor as ta, titles as t, authors as aWHERE ta.au_id &#x3D; a.au_id and ta.title_id &#x3D; t.title_idSELECT t.title, a.au_fname, a.au_fnameFROM titleauthor as ta inner join titles as t      on (ta.title_id &#x3D; t.title_id)     inner join authors as a on (ta.au_id &#x3D; a.au_id)外联接SELECT * FROM stores -6个书店SELECT * FROM discounts  -3种折扣，其中1种有1个商店在执行显示打折的书店和折扣信息SELECT * FROM stores inner join discounts       on (stores.stor_id &#x3D; discounts.stor_id)左向外联接显示所有书店的编号和名字，如果商店有折扣在执行，则显示折扣类型SELECT stores.stor_id, stores.stor_name, discounts.discounttypeFROM stores left outer join discounts      on (stores.stor_id &#x3D; discounts.stor_id)右向外联接显示所有折扣类型，如果有书店在执行某个折扣类型，则显示书店名字SELECT stores.stor_id, stores.stor_name, discounts.discounttypeFROM stores right outer join discounts      on (stores.stor_id &#x3D; discounts.stor_id)全向外联接折扣类型和书店信息都要出来，如果某个书店正在执行某个折扣类型，则融合显示SELECT stores.stor_id, stores.stor_name, discounts.discounttypeFROM stores full outer join discounts      on (stores.stor_id &#x3D; discounts.stor_id)内联接检索与某个出版商居住在相同州和城市的作者：SELECT * FROM publishersSELECT * FROM authorsSELECT a.au_fname, a.au_lname, p.pub_nameFROM authors as a inner join publishers as pon (a.city &#x3D; p.city and a.state &#x3D; p.state)与某个出版商居住在相同州和城市的作者，若要在结果中包括所有的作者，而不管出版商是否住在同一个城市，左向外联接SELECT a.au_fname, a.au_lname, p.pub_nameFROM authors as a left outer join publishers as pon (a.city &#x3D; p.city and a.state &#x3D; p.state)若要在结果中包括所有作者和出版商，而不管城市中是否有出版商或者出版商是否住在同一个城市，请使用完整外部联接SELECT a.au_fname, a.au_lname, p.pub_nameFROM authors as a full outer join publishers as pon (a.city &#x3D; p.city and a.state &#x3D; p.state)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SQL-DML"><a href="#SQL-DML" class="headerlink" title="SQL-DML"></a>SQL-DML</h2><ul><li>增：INSERT</li><li>删：DELETE</li><li>改：UPDATE</li></ul><p>上述都是选择了某个表进行操作，实质上是对表中数据进行操作，如：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">delete</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span><span class="token keyword">where</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span> <span class="token keyword">value</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token keyword">update</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span><span class="token keyword">set</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">where</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-------------------------删除数据 DELETE--------------------</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">INTO</span> mytitle<span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytitle5<span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">INTO</span> mytitle5<span class="token keyword">FROM</span> titles<span class="token keyword">DELETE</span> mytitle<span class="token keyword">DELETE</span> mytitle3<span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span><span class="token keyword">DELETE</span> mytitle3<span class="token keyword">WHERE</span> price <span class="token operator">></span> <span class="token number">10</span><span class="token keyword">DELETE</span> mytitle3<span class="token keyword">WHERE</span> price <span class="token operator">is</span> <span class="token boolean">null</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> mytitle4<span class="token keyword">WHERE</span> price <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">max</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">FROM</span> mytitle4<span class="token punctuation">)</span><span class="token keyword">DELETE</span> mytitle4<span class="token keyword">WHERE</span> price <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">max</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">FROM</span> mytitle4<span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> publishersNew Moon Books<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytitle4 <span class="token keyword">as</span> t <span class="token keyword">inner</span> <span class="token keyword">join</span> publishers <span class="token keyword">as</span> p<span class="token keyword">on</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> p<span class="token punctuation">.</span>pub_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> pub_name <span class="token operator">=</span> <span class="token string">'New Moon Books'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytitle4 <span class="token keyword">WHERE</span> pub_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> pub_id <span class="token keyword">FROM</span> publishers         <span class="token keyword">WHERE</span> pub_name <span class="token operator">=</span> <span class="token string">'New Moon Books'</span><span class="token punctuation">)</span><span class="token keyword">DELETE</span> mytitle4<span class="token keyword">FROM</span> mytitle4 <span class="token keyword">as</span> t <span class="token keyword">inner</span> <span class="token keyword">join</span> publishers <span class="token keyword">as</span> p<span class="token keyword">on</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> p<span class="token punctuation">.</span>pub_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> pub_name <span class="token operator">=</span> <span class="token string">'New Moon Books'</span><span class="token keyword">DELETE</span> mytitle4 <span class="token keyword">WHERE</span> pub_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> pub_id <span class="token keyword">FROM</span> publishers         <span class="token keyword">WHERE</span> pub_name <span class="token operator">=</span> <span class="token string">'New Moon Books'</span><span class="token punctuation">)</span><span class="token keyword">DELETE</span> titles消息 <span class="token number">547</span>，级别 <span class="token number">16</span>，状态 <span class="token number">0</span>，第 <span class="token number">1</span> 行<span class="token keyword">DELETE</span> 语句与 REFERENCE 约束<span class="token string">"FK__titleauth__title__1ED998B2"</span>冲突。该冲突发生于数据库<span class="token string">"pubs"</span>，表<span class="token string">"dbo.titleauthor"</span><span class="token punctuation">,</span> <span class="token keyword">column</span> <span class="token string">'title_id'</span>。语句已终止。<span class="token keyword">DELETE</span> titleauthor<span class="token keyword">DELETE</span> titles消息 <span class="token number">547</span>，级别 <span class="token number">16</span>，状态 <span class="token number">0</span>，第 <span class="token number">1</span> 行<span class="token keyword">DELETE</span> 语句与 REFERENCE 约束<span class="token string">"FK__sales__title_id__24927208"</span>冲突。该冲突发生于数据库<span class="token string">"pubs"</span>，表<span class="token string">"dbo.sales"</span><span class="token punctuation">,</span> <span class="token keyword">column</span> <span class="token string">'title_id'</span>。语句已终止。<span class="token keyword">DELETE</span> sales<span class="token keyword">DELETE</span> titles消息 <span class="token number">547</span>，级别 <span class="token number">16</span>，状态 <span class="token number">0</span>，第 <span class="token number">1</span> 行<span class="token keyword">DELETE</span> 语句与 REFERENCE 约束<span class="token string">"FK__roysched__title___267ABA7A"</span>冲突。该冲突发生于数据库<span class="token string">"pubs"</span>，表<span class="token string">"dbo.roysched"</span><span class="token punctuation">,</span> <span class="token keyword">column</span> <span class="token string">'title_id'</span>。语句已终止。<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> title_id <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> title_id <span class="token keyword">FROM</span> roysched<span class="token punctuation">)</span><span class="token keyword">DELETE</span> titles<span class="token keyword">WHERE</span> title_id <span class="token operator">=</span> <span class="token string">'PC9999'</span><span class="token comment">--------------------------------INSERT 新增数据------------</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student <span class="token punctuation">(</span>sid<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> old<span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'10000'</span><span class="token punctuation">,</span><span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'13810008888'</span><span class="token punctuation">)</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student <span class="token punctuation">(</span>sid<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> old<span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'10001'</span><span class="token punctuation">,</span><span class="token string">'李四'</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">'13770008888'</span><span class="token punctuation">)</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student <span class="token punctuation">(</span>sid<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> old<span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'10002'</span><span class="token punctuation">,</span><span class="token string">'王五'</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'13313003338'</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'10003'</span><span class="token punctuation">,</span><span class="token string">'赵六'</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'13111003331'</span><span class="token punctuation">)</span><span class="token comment">-----</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'10003'</span><span class="token punctuation">,</span><span class="token string">'赵六'</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'13111003331'</span><span class="token punctuation">)</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'10004'</span><span class="token punctuation">,</span><span class="token string">'赵六'</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'13111003331'</span><span class="token punctuation">)</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'10005'</span><span class="token punctuation">,</span> <span class="token string">'钱七'</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student <span class="token punctuation">(</span>sid<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> old<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'10005'</span><span class="token punctuation">,</span> <span class="token string">'钱七'</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student <span class="token punctuation">(</span>sid<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> gender<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'10006'</span><span class="token punctuation">,</span> <span class="token string">'八'</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student <span class="token punctuation">(</span>sid<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> old<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'10006'</span><span class="token punctuation">,</span> <span class="token string">'八'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student <span class="token punctuation">(</span>sid<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> old<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'10007'</span><span class="token punctuation">,</span> <span class="token string">'九'</span><span class="token punctuation">,</span> <span class="token string">'20'</span><span class="token punctuation">)</span><span class="token comment">------</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student <span class="token punctuation">(</span>sid<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> old<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token keyword">SELECT</span>  <span class="token keyword">LEFT</span><span class="token punctuation">(</span>au_id<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         au_lname <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> au_fname<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span>phone<span class="token keyword">FROM</span> authors<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token comment">--------------------------UPDATE 更新数据-----------------</span><span class="token keyword">UPDATE</span> student<span class="token keyword">SET</span> gender <span class="token operator">=</span> <span class="token string">'女'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token keyword">UPDATE</span> student<span class="token keyword">SET</span> gender <span class="token operator">=</span> <span class="token string">'男'</span><span class="token punctuation">,</span> old <span class="token operator">=</span> old <span class="token operator">+</span> <span class="token number">10</span><span class="token keyword">UPDATE</span> student <span class="token keyword">SET</span> old <span class="token operator">=</span> <span class="token number">33</span><span class="token keyword">WHERE</span> sname <span class="token operator">=</span> <span class="token string">'李四'</span>销量排名前十的书，全部涨价<span class="token number">50</span><span class="token operator">%</span><span class="token keyword">UPDATE</span> titles<span class="token keyword">SET</span> price <span class="token operator">=</span> price <span class="token operator">*</span> <span class="token number">1.5</span><span class="token keyword">WHERE</span> title_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">TOP</span> <span class="token number">10</span> title_id <span class="token keyword">FROM</span> titles<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ytd_sales <span class="token keyword">DESC</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> publishers <span class="token keyword">as</span> p <span class="token keyword">inner</span> <span class="token keyword">join</span> titles <span class="token keyword">as</span> t<span class="token keyword">on</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> t<span class="token punctuation">.</span>pub_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> pub_name <span class="token operator">=</span> <span class="token string">'New Moon Books'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> pub_id <span class="token operator">in</span> <span class="token punctuation">(</span>  <span class="token keyword">SELECT</span> pub_id <span class="token keyword">FROM</span> publishers  <span class="token keyword">WHERE</span> pub_name <span class="token operator">=</span> <span class="token string">'New Moon Books'</span><span class="token punctuation">)</span><span class="token keyword">UPDATE</span> titles<span class="token keyword">SET</span> price <span class="token operator">=</span> price <span class="token operator">*</span> <span class="token number">0.8</span><span class="token keyword">FROM</span> publishers <span class="token keyword">as</span> p <span class="token keyword">inner</span> <span class="token keyword">join</span> titles <span class="token keyword">as</span> t<span class="token keyword">on</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> t<span class="token punctuation">.</span>pub_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> pub_name <span class="token operator">=</span> <span class="token string">'New Moon Books'</span><span class="token keyword">UPDATE</span> titles<span class="token keyword">SET</span> price <span class="token operator">=</span> price <span class="token operator">+</span> <span class="token number">10</span><span class="token keyword">WHERE</span> pub_id <span class="token operator">in</span> <span class="token punctuation">(</span>  <span class="token keyword">SELECT</span> pub_id <span class="token keyword">FROM</span> publishers  <span class="token keyword">WHERE</span> pub_name <span class="token operator">=</span> <span class="token string">'New Moon Books'</span><span class="token punctuation">)</span><span class="token keyword">UPDATE</span> titles<span class="token keyword">SET</span> title_id <span class="token operator">=</span> <span class="token string">'BU2080'</span><span class="token keyword">WHERE</span> title_id <span class="token operator">=</span> <span class="token string">'BU2075'</span><span class="token keyword">UPDATE</span> publishers<span class="token keyword">SET</span> pub_id <span class="token operator">=</span> <span class="token string">'9998'</span><span class="token keyword">WHERE</span> pub_id <span class="token operator">=</span> <span class="token string">'9999'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SQL-DDL"><a href="#SQL-DDL" class="headerlink" title="SQL-DDL"></a>SQL-DDL</h2><p>DDL<strong>负责各类数据库对象的创建、修改、删除</strong></p><p>如<strong>数据库、表、视图、索引、存储过程、规则</strong>等</p><ul><li>创建：CREATE</li><li>修改：ALTER</li><li>删除：DROP</li></ul><h2 id="VIEW"><a href="#VIEW" class="headerlink" title="VIEW"></a>VIEW</h2><p>一个VIEW相当于一张虚拟表</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">场景：<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> ytd_sales <span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> publishers<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> ytd_sales<span class="token punctuation">,</span> pub_name<span class="token keyword">FROM</span> titles <span class="token keyword">as</span> t <span class="token keyword">inner</span> <span class="token keyword">join</span> publishers <span class="token keyword">as</span> p <span class="token keyword">on</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> p<span class="token punctuation">.</span>pub_id<span class="token punctuation">)</span><span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> ytd_sales<span class="token punctuation">,</span> pub_name<span class="token keyword">FROM</span> titles <span class="token keyword">as</span> t <span class="token keyword">inner</span> <span class="token keyword">join</span> publishers <span class="token keyword">as</span> p <span class="token keyword">on</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> p<span class="token punctuation">.</span>pub_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> price <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">and</span> ytd_sales <span class="token operator">></span> <span class="token number">1000</span><span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> ytd_sales<span class="token punctuation">,</span> pub_name<span class="token keyword">FROM</span> titles <span class="token keyword">as</span> t <span class="token keyword">inner</span> <span class="token keyword">join</span> publishers <span class="token keyword">as</span> p <span class="token keyword">on</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> p<span class="token punctuation">.</span>pub_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> title <span class="token operator">like</span> <span class="token string">'%computer%'</span><span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> ytd_sales<span class="token punctuation">,</span> pub_name<span class="token keyword">FROM</span> titles <span class="token keyword">as</span> t <span class="token keyword">inner</span> <span class="token keyword">join</span> publishers <span class="token keyword">as</span> p <span class="token keyword">on</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> p<span class="token punctuation">.</span>pub_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> title <span class="token operator">like</span> <span class="token string">'%computer%'</span> <span class="token operator">and</span> price <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token comment">--------------------------视图------------------------</span><span class="token number">1.</span> 用户眼中的数据（数据库、数据表），是用户视角下的数据组织形式   它和实际<span class="token keyword">SQL</span> SERVER里面的表的组织方式（ER图）不一样   这是数据库的三级结构（用户级、外模式、逻辑独立性）决定的<span class="token number">2.</span> 程序员会把用户常用的一些视角，事先把<span class="token keyword">select</span> <span class="token keyword">sql</span>语句写好，存起来。   注意，存的不是数据，存的是视角（<span class="token keyword">sql</span>语句），这样方便程序员以后在这个视角下继续加条件。综合<span class="token number">1</span><span class="token operator">+</span><span class="token number">2</span><span class="token comment">---》新概念，视图，VIEW</span><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> v_buybook<span class="token keyword">AS</span><span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price<span class="token punctuation">,</span> ytd_sales<span class="token punctuation">,</span> pub_name<span class="token keyword">FROM</span> titles <span class="token keyword">as</span> t <span class="token keyword">inner</span> <span class="token keyword">join</span> publishers <span class="token keyword">as</span> p <span class="token keyword">on</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> p<span class="token punctuation">.</span>pub_id<span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v_buybook<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v_buybook<span class="token keyword">WHERE</span> title <span class="token operator">like</span> <span class="token string">'%computer%'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> View_1<span class="token keyword">SELECT</span>  dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>title<span class="token punctuation">,</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>price<span class="token punctuation">,</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>ytd_sales<span class="token punctuation">,</span> dbo<span class="token punctuation">.</span>publishers<span class="token punctuation">.</span>pub_name<span class="token keyword">FROM</span>      dbo<span class="token punctuation">.</span>publishers <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>                   dbo<span class="token punctuation">.</span>titles <span class="token keyword">ON</span> dbo<span class="token punctuation">.</span>publishers<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>pub_id<span class="token keyword">WHERE</span>   <span class="token punctuation">(</span>dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>title <span class="token operator">LIKE</span> <span class="token string">'%computer%'</span><span class="token punctuation">)</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>title<span class="token keyword">SELECT</span>  <span class="token keyword">TOP</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">PERCENT</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>title<span class="token punctuation">,</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>price<span class="token punctuation">,</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>ytd_sales<span class="token punctuation">,</span> dbo<span class="token punctuation">.</span>publishers<span class="token punctuation">.</span>pub_name<span class="token punctuation">,</span> dbo<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>au_lname<span class="token punctuation">,</span>                    dbo<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>au_fname<span class="token keyword">FROM</span>      dbo<span class="token punctuation">.</span>publishers <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>                   dbo<span class="token punctuation">.</span>titles <span class="token keyword">ON</span> dbo<span class="token punctuation">.</span>publishers<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>pub_id <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>                   dbo<span class="token punctuation">.</span>titleauthor <span class="token keyword">ON</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>title_id <span class="token operator">=</span> dbo<span class="token punctuation">.</span>titleauthor<span class="token punctuation">.</span>title_id <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>                   dbo<span class="token punctuation">.</span>authors <span class="token keyword">ON</span> dbo<span class="token punctuation">.</span>titleauthor<span class="token punctuation">.</span>au_id <span class="token operator">=</span> dbo<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>au_id<span class="token keyword">WHERE</span>   <span class="token punctuation">(</span>dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>title <span class="token operator">LIKE</span> <span class="token string">'%computer%'</span><span class="token punctuation">)</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>title<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>采用B树结构</p><p>簇索引和非簇索引</p><h3 id="簇索引"><a href="#簇索引" class="headerlink" title="簇索引"></a>簇索引</h3><p><strong>在叶节点中存储了表的实际行数据，所以一旦到达叶节点，数据就立刻可以使用</strong></p><p>主键是聚簇索引的良好候选者</p><p>缺省设置创建的索引是非聚簇索引</p><h3 id="非簇索引"><a href="#非簇索引" class="headerlink" title="非簇索引"></a>非簇索引</h3><p><strong>非簇索引的结构类似于簇索引，但是表的数据不存储在索引的叶节点上，表的数据也不按照索引列排序</strong></p><h3 id="索引的唯一性"><a href="#索引的唯一性" class="headerlink" title="索引的唯一性"></a>索引的唯一性</h3><p><strong>非唯一性索引效率不如唯一性效率高</strong></p><ul><li><p>唯一索引</p><p><strong>必须在数据库表中具有唯一值特性的列上创建</strong></p><p><strong>唯一索引在各索引键中仅包含一行数据表中的数据</strong></p><p><strong>在创建主键约束和唯一约束时自动创建</strong></p></li><li><p>非唯一索引</p><p><strong>在叶节点中可以包含重复值，如果它们符合SELECT语句中指定的标准，那么所有重复值都可以被检索</strong></p></li></ul><h3 id="有效使用索引"><a href="#有效使用索引" class="headerlink" title="有效使用索引"></a>有效使用索引</h3><p><strong>在对索引列进行查询时，不在查询where子句中显式地加入NOT词，否则无法使用索引</strong></p><h3 id="维护索引"><a href="#维护索引" class="headerlink" title="维护索引"></a>维护索引</h3><blockquote><blockquote><p>查看索引状态</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DBCC</span> SHOWCONTIG<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></blockquote><blockquote><p>重建索引</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">index</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">drop</span> existing<span class="token keyword">DBCC</span> DBREINDEX<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><blockquote><p>整理索引碎片</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DBCC</span> INDEXDEFRAG<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></blockquote><blockquote><p>索引统计信息</p><blockquote><p>查看</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DBCC</span> SHOW_STATISTICS<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></blockquote></blockquote></blockquote><h3 id="索引优缺点"><a href="#索引优缺点" class="headerlink" title="索引优缺点"></a>索引优缺点</h3><h4 id="索引优点"><a href="#索引优点" class="headerlink" title="索引优点"></a>索引优点</h4><ul><li>加速数据检索</li><li>加速连接、order by和Group by</li><li>查询优化器</li><li>强制实施行的唯一性</li></ul><h4 id="索引缺点"><a href="#索引缺点" class="headerlink" title="索引缺点"></a>索引缺点</h4><ul><li>基于代价</li><li>索引创建花费时间、空间</li><li>减慢了数据修改速度</li></ul><h3 id="适合使用索引的情况"><a href="#适合使用索引的情况" class="headerlink" title="适合使用索引的情况"></a>适合使用索引的情况</h3><ul><li>主键适合簇索引</li><li>连接中频繁使用的列</li><li>列常需要排序、分组</li><li>查询访问较少的数据</li></ul><h3 id="不适合使用"><a href="#不适合使用" class="headerlink" title="不适合使用"></a>不适合使用</h3><ul><li>不常在查询中引用的列</li><li>值少的列</li><li>小表</li><li>经常增删查改的表</li><li>null</li></ul><h2 id="SQL-syntax"><a href="#SQL-syntax" class="headerlink" title="SQL-syntax"></a>SQL-syntax</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> CEILING<span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> FLOOR<span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> SIN<span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token keyword">LEFT</span><span class="token punctuation">(</span>UPPER<span class="token punctuation">(</span>au_lname<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">LEFT</span><span class="token punctuation">(</span>UPPER<span class="token punctuation">(</span>au_fname<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">FROM</span> authors<span class="token keyword">SELECT</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span>GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> DATEADD<span class="token punctuation">(</span>dd<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span> getdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> DATEDIFF<span class="token punctuation">(</span>dd<span class="token punctuation">,</span> <span class="token string">'2023-5-11'</span><span class="token punctuation">,</span> getdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> cast<span class="token punctuation">(</span>ytd_sales <span class="token keyword">as</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">like</span> <span class="token string">'15%'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> ytd_sales <span class="token operator">like</span> <span class="token string">'15%'</span><span class="token keyword">SELECT</span> title <span class="token operator">+</span> <span class="token string">' 这本书的销量是： '</span> <span class="token operator">+</span> ytd_sales<span class="token keyword">FROM</span> titles<span class="token keyword">SELECT</span> title <span class="token operator">+</span> <span class="token string">' 这本书的销量是： '</span> <span class="token operator">+</span> cast<span class="token punctuation">(</span>ytd_sales <span class="token keyword">as</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">FROM</span> titles<span class="token keyword">DECLARE</span>    <span class="token variable">@myfirstvar</span> <span class="token keyword">int</span><span class="token keyword">SET</span>   <span class="token variable">@myfirstvar</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> price <span class="token operator">></span> <span class="token variable">@myfirstvar</span><span class="token keyword">DECLARE</span>    <span class="token variable">@mysecondvar</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token variable">@mythird</span> <span class="token keyword">int</span><span class="token keyword">SET</span> <span class="token variable">@mysecondvar</span> <span class="token operator">=</span> <span class="token string">'computer'</span><span class="token keyword">SET</span> <span class="token variable">@mythird</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> titles<span class="token keyword">WHERE</span> title <span class="token operator">like</span> <span class="token string">'%'</span> <span class="token operator">+</span> <span class="token variable">@mysecondvar</span> <span class="token operator">+</span> <span class="token string">'%'</span>      <span class="token operator">and</span> price <span class="token operator">&lt;</span> <span class="token variable">@mythird</span><span class="token keyword">DECLARE</span>  <span class="token variable">@mycontrol</span> <span class="token keyword">int</span><span class="token punctuation">,</span>  <span class="token variable">@myinputprice</span> <span class="token keyword">int</span><span class="token keyword">SET</span> <span class="token variable">@myinputprice</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">20</span><span class="token keyword">SET</span> <span class="token variable">@mycontrol</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> titles <span class="token keyword">WHERE</span> price <span class="token operator">&lt;</span> <span class="token variable">@myinputprice</span><span class="token punctuation">)</span><span class="token keyword">IF</span> <span class="token variable">@mycontrol</span> <span class="token operator">></span> <span class="token number">0</span><span class="token keyword">BEGIN</span>  <span class="token keyword">SELECT</span> title<span class="token punctuation">,</span> price <span class="token keyword">FROM</span> titles   <span class="token keyword">WHERE</span> price <span class="token operator">&lt;</span> <span class="token variable">@myinputprice</span><span class="token keyword">END</span><span class="token keyword">ELSE</span><span class="token keyword">BEGIN</span>  <span class="token keyword">SELECT</span> <span class="token keyword">TOP</span> <span class="token number">3</span> title<span class="token punctuation">,</span> price <span class="token keyword">FROM</span> titles  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ytd_sales <span class="token keyword">DESC</span><span class="token keyword">END</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SQL-cursor"><a href="#SQL-cursor" class="headerlink" title="SQL-cursor"></a>SQL-cursor</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">/*-----------------------------------------------------游标---关系数据库中的操作会对整个行集产生影响。由 SELECT 语句返回的行集包括所有满足该语句 WHERE 子句中条件的行。由语句所返回的这一完整的行集被称为结果集。应用程序，特别是交互式联机应用程序，并不总能将整个结果集作为一个单元来有效地处理。这些应用程序需要一种机制以便每次处理一行或一部分行。游标就是提供这种机制的结果集扩展。 -------------------------------------------------------*/</span><span class="token comment">---------------------------------------------------------------------------------</span><span class="token comment">--游标基本语法</span><span class="token comment">---------------------------------------------------------------------------------</span><span class="token keyword">DECLARE</span> Employee_Cursor <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span><span class="token keyword">SELECT</span> LastName<span class="token punctuation">,</span> FirstName <span class="token keyword">FROM</span> Northwind<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>Employees<span class="token keyword">OPEN</span> Employee_Cursor<span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> Employee_Cursor<span class="token keyword">WHILE</span> @<span class="token variable">@FETCH_STATUS</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">BEGIN</span>   <span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> Employee_Cursor<span class="token keyword">END</span><span class="token keyword">CLOSE</span> Employee_Cursor<span class="token keyword">DEALLOCATE</span> Employee_Cursor<span class="token comment">---------------------------------------------------------------------------------</span><span class="token comment">--游标读取行的值 </span><span class="token comment">---------------------------------------------------------------------------------</span><span class="token comment">-- Declare the variables to store the values returned by FETCH.</span><span class="token keyword">DECLARE</span> <span class="token variable">@au_lname</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">@au_fname</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">DECLARE</span> authors_cursor <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span><span class="token keyword">SELECT</span> au_lname<span class="token punctuation">,</span> au_fname <span class="token keyword">FROM</span> authors<span class="token keyword">WHERE</span> au_lname <span class="token operator">LIKE</span> <span class="token string">'B%'</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> au_lname<span class="token punctuation">,</span> au_fname<span class="token keyword">OPEN</span> authors_cursor<span class="token comment">-- Perform the first fetch and store the values in variables.</span><span class="token comment">-- Note: The variables are in the same order as the columns</span><span class="token comment">-- in the SELECT statement. </span><span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> authors_cursor<span class="token keyword">INTO</span> <span class="token variable">@au_lname</span><span class="token punctuation">,</span> <span class="token variable">@au_fname</span><span class="token comment">-- Check @@FETCH_STATUS to see if there are any more rows to fetch.</span><span class="token keyword">WHILE</span> @<span class="token variable">@FETCH_STATUS</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">BEGIN</span>   <span class="token comment">-- Concatenate and display the current values in the variables.</span>   <span class="token keyword">PRINT</span> <span class="token string">'Author: '</span> <span class="token operator">+</span> <span class="token variable">@au_fname</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span>  <span class="token variable">@au_lname</span>   <span class="token comment">-- This is executed as long as the previous fetch succeeds.</span>   <span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> authors_cursor   <span class="token keyword">INTO</span> <span class="token variable">@au_lname</span><span class="token punctuation">,</span> <span class="token variable">@au_fname</span><span class="token keyword">END</span><span class="token keyword">CLOSE</span> authors_cursor<span class="token keyword">DEALLOCATE</span> authors_cursorGO<span class="token comment">/*-----------------------------------------------------------------------------------查询所有商业书籍在1993年的销售量 输出2列  书名和1993年销售量商业书                                                                  1993年销售量    ------------------------------------------------------------------       ----------- Cooking with Computers: Surreptitious Balance Sheets                             25Straight Talk About Computers                                                    15The Busy Executive's Database Guide                                              15You Can Combat Computer Stress!                                                  35---------------------------------------------------------------------------------*/</span><span class="token keyword">DECLARE</span>    authorcursor <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span>  <span class="token comment">--在所有商业书的查询结果上建立游标</span><span class="token keyword">SELECT</span> title_id<span class="token punctuation">,</span>title <span class="token keyword">FROM</span> titles <span class="token keyword">WHERE</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> title<span class="token keyword">OPEN</span> authorcursor<span class="token comment">--打开游标</span><span class="token keyword">DECLARE</span>    <span class="token variable">@Mytitle_id</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">--声明一些变量存储临时结果</span>   <span class="token variable">@Mytitle</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">@SumQty</span> <span class="token keyword">int</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token comment">#Tempcursor (--创建临时表存储临时结果</span><span class="token punctuation">[</span>title<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">varchar</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> Chinese_PRC_CI_AS <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>        <span class="token punctuation">[</span>sumqty<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token punctuation">[</span><span class="token keyword">PRIMARY</span><span class="token punctuation">]</span><span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> authorcursor <span class="token comment">--启动游标读第一条纪录，把纪录的值放入变量</span>      <span class="token keyword">INTO</span> <span class="token variable">@Mytitle_id</span><span class="token punctuation">,</span><span class="token variable">@mytitle</span><span class="token keyword">WHILE</span> @<span class="token variable">@FETCH_STATUS</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token comment">--循环读取纪录</span><span class="token keyword">BEGIN</span>          <span class="token comment">--对每次读取的书的编号，到另外的表中求汇总值</span>  <span class="token keyword">SET</span> <span class="token variable">@SumQty</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">Sum</span><span class="token punctuation">(</span>qty<span class="token punctuation">)</span> <span class="token keyword">FROM</span> sales <span class="token keyword">WHERE</span> title_id <span class="token operator">=</span> <span class="token variable">@MyTitle_id</span> <span class="token operator">AND</span> ord_date <span class="token operator">between</span> <span class="token string">'1991-1-1'</span> <span class="token operator">AND</span> <span class="token string">'1999-12-31'</span><span class="token punctuation">)</span> <span class="token comment">--把每次算出的一个书的结果插入临时表</span>  <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token comment">#tempcursor VAlues(@Mytitle,@SumQty)       --再向下读取另外一本书</span>  <span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> authorcursor <span class="token keyword">INTO</span> <span class="token variable">@Mytitle_id</span><span class="token punctuation">,</span><span class="token variable">@mytitle</span><span class="token keyword">END</span><span class="token keyword">CLOSE</span> authorcursor<span class="token comment">--关闭游标</span><span class="token keyword">DEALLOCATE</span> authorcursor<span class="token comment">--释放游标</span><span class="token comment">--把最后所有中间算出的每本书的结果从临时表中读取出来，返回结果</span><span class="token keyword">Select</span> title <span class="token keyword">as</span> <span class="token string">'商业书'</span><span class="token punctuation">,</span> sumqty <span class="token keyword">as</span> <span class="token string">'1993年销售量'</span> <span class="token keyword">from</span> <span class="token comment">#tempCursor</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token comment">#tempcursor--删除临时表</span>GO<span class="token comment">/*-----------------------------------------------------------------------------------查询所有在美国的客户的最近一次销售纪录的总额和日期 northwind数据库   美国顾客编号 最近一次购物时间                                               总金额                   ------ ------------------------------------------------------ --------------------- GREAL  1998-04-30 00:00:00.000                                510.0000HUNGC  1997-09-08 00:00:00.000                                1701.0000LAZYK  1997-05-22 00:00:00.000                                210.0000LETSS  1998-02-12 00:00:00.000                                1450.6000LONEP  1998-04-13 00:00:00.000                                1575.0000OLDWO  1998-04-20 00:00:00.000                                554.4000RATTC  1998-05-06 00:00:00.000                                1374.6000SAVEA  1998-05-01 00:00:00.000                                4722.3000SPLIR  1998-03-25 00:00:00.000                                439.0000THEBI  1998-04-01 00:00:00.000                                69.6000THECR  1998-04-06 00:00:00.000                                326.0000TRAIH  1998-01-08 00:00:00.000                                237.9000WHITC  1998-05-01 00:00:00.000                                928.7500----------------------------------------------------------------------------- */</span><span class="token keyword">Declare</span>   <span class="token variable">@LastOrderDate</span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>   <span class="token variable">@LastOrderID</span> <span class="token keyword">int</span><span class="token punctuation">,</span>   <span class="token variable">@LastOrderMoney</span> money<span class="token punctuation">,</span>   <span class="token variable">@TempCustomerID</span> <span class="token keyword">nchar</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token comment">#Tempcursor (--创建临时表存储临时结果</span><span class="token punctuation">[</span>CustomerID<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">nchar</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> Chinese_PRC_CI_AS <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>        <span class="token punctuation">[</span>OrderDate<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">datetime</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span>SumMoney<span class="token punctuation">]</span> <span class="token punctuation">[</span>money<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token punctuation">[</span><span class="token keyword">PRIMARY</span><span class="token punctuation">]</span><span class="token keyword">DECLARE</span> Employee_Cursor <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span><span class="token keyword">SELECT</span> CustomerID <span class="token keyword">FROM</span> Customers <span class="token keyword">WHERE</span> Country <span class="token operator">=</span> <span class="token string">'USA'</span><span class="token keyword">OPEN</span> Employee_Cursor<span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> Employee_Cursor      <span class="token keyword">INTO</span> <span class="token variable">@TempCustomerID</span><span class="token keyword">WHILE</span> @<span class="token variable">@FETCH_STATUS</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">BEGIN</span>   <span class="token keyword">SET</span> <span class="token variable">@LastOrderdate</span> <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>OrderDate<span class="token punctuation">)</span> <span class="token keyword">FROM</span> Orders <span class="token keyword">WHERE</span> CustomerID <span class="token operator">=</span> <span class="token variable">@TempCustomerID</span><span class="token punctuation">)</span>    <span class="token keyword">SET</span> <span class="token variable">@LastOrderID</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> OrderID <span class="token keyword">FROM</span> Orders <span class="token keyword">WHERE</span> OrderDate <span class="token operator">=</span> <span class="token variable">@LastOrderDate</span> <span class="token operator">AND</span>   CustomerID <span class="token operator">=</span> <span class="token variable">@TempCustomerID</span><span class="token punctuation">)</span>   <span class="token keyword">SET</span> <span class="token variable">@LastOrderMoney</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">Sum</span><span class="token punctuation">(</span>UnitPrice<span class="token operator">*</span>Quantity<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">[</span><span class="token keyword">Order</span> Details<span class="token punctuation">]</span> <span class="token keyword">WHERE</span> OrderID <span class="token operator">=</span> <span class="token variable">@LastOrderID</span><span class="token punctuation">)</span>   <span class="token keyword">Insert</span> <span class="token keyword">INTO</span> <span class="token comment">#TempCursor  </span>   <span class="token keyword">Values</span><span class="token punctuation">(</span><span class="token variable">@TempCustomerID</span><span class="token punctuation">,</span><span class="token variable">@LastOrderDate</span><span class="token punctuation">,</span><span class="token variable">@LastOrderMoney</span><span class="token punctuation">)</span>      <span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> Employee_Cursor <span class="token keyword">INTO</span> <span class="token variable">@TempCustomerID</span><span class="token keyword">END</span><span class="token keyword">CLOSE</span> Employee_Cursor<span class="token keyword">DEALLOCATE</span> Employee_Cursor<span class="token keyword">SELECT</span> CustomerID <span class="token keyword">as</span> <span class="token string">'美国顾客编号'</span><span class="token punctuation">,</span> OrderDate <span class="token keyword">as</span> <span class="token string">'最近一次购物时间'</span><span class="token punctuation">,</span>SumMoney <span class="token keyword">as</span> <span class="token string">'总金额'</span> <span class="token keyword">FROM</span> <span class="token comment">#TempCursor</span> <span class="token keyword">Drop</span> <span class="token keyword">table</span> <span class="token comment">#Tempcursor</span><span class="token comment">/*-----------思考题-northwind数据库---------------------------------国家名称                 该国最受欢迎产品奖                                                                        -------------------- -------------------------------------------------------------------------------- Argentina            Queso CabralesAustria              Guaraná FantásticaBelgium              Raclette CourdavaultBrazil               Camembert PierrotCanada               Camembert PierrotDenmark              Original Frankfurter grüne So?eFinland              FlotemysostFrance               Tarte au sucreGermany              Camembert PierrotIreland              Thüringer RostbratwurstItaly                Mozzarella di GiovanniMexico               Queso CabralesNorway               Guaraná FantásticaPoland               Rh?nbr?u Klosterbier 并列第一Poland               Gorgonzola Telino    并列第一Portugal             Gnocchi di nonna AliceSpain                Alice MuttonSweden               Zaanse koekenSwitzerland          GudbrandsdalsostUK                   Gorgonzola TelinoUSA                  Gnocchi di nonna AliceVenezuela            Outback Lager在顾客表中统计每个国家的顾客最喜欢哪个产品----------------------------------------------------------------*/</span><span class="token keyword">Create</span> <span class="token keyword">procedure</span> p_LovestOfContry<span class="token keyword">as</span><span class="token keyword">DECLARE</span>    mycursor <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span>  <span class="token comment">--建立对顾客表上国家的分组的查询的游标</span>   <span class="token keyword">SELECT</span> Country <span class="token keyword">FROM</span> Customers    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Country<span class="token keyword">OPEN</span> mycursor<span class="token comment">--打开游标</span><span class="token keyword">DECLARE</span>    <span class="token variable">@CountryIN</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">--声明一些变量存储临时结果</span>   <span class="token variable">@ProductIDIN</span> <span class="token keyword">int</span><span class="token punctuation">,</span>   <span class="token variable">@ProductNameIN</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token variable">@MaxNumIN</span> <span class="token keyword">int</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token comment">#Tempcursor (--创建临时表存储临时结果</span><span class="token punctuation">[</span>CountryName<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">varchar</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> Chinese_PRC_CI_AS <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>        <span class="token punctuation">[</span>ProductName<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">varchar</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token punctuation">[</span><span class="token keyword">PRIMARY</span><span class="token punctuation">]</span><span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> mycursor <span class="token keyword">INTO</span> <span class="token variable">@CountryIN</span>  <span class="token comment">--启动游标读第一条纪录，把纪录的值放入变量</span><span class="token keyword">WHILE</span> @<span class="token variable">@FETCH_STATUS</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token comment">--循环读取纪录</span><span class="token keyword">BEGIN</span>            <span class="token keyword">SELECT</span> ProductID<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>Quantity<span class="token punctuation">)</span> <span class="token keyword">as</span> SumQuantity   <span class="token comment">--统计某个国家的客户的所有定单中按产品编号分组统计总销售量</span>  <span class="token keyword">INTO</span> <span class="token comment">#mytemp   --把统计结果送入另一个临时表#mytemp，便以后继续操作</span>  <span class="token keyword">FROM</span> <span class="token punctuation">[</span><span class="token keyword">Order</span> Details<span class="token punctuation">]</span>   <span class="token keyword">WHERE</span> OrderID <span class="token operator">IN</span>  <span class="token punctuation">(</span>      <span class="token keyword">SELECT</span> OrderID   <span class="token comment">--统计出某个国家的客户的所有定单编号</span>      <span class="token keyword">FROM</span> Orders <span class="token keyword">Join</span> Customers <span class="token keyword">ON</span> Orders<span class="token punctuation">.</span>CustomerID <span class="token operator">=</span> Customers<span class="token punctuation">.</span>CustomerID      <span class="token keyword">WHERE</span> Country <span class="token operator">=</span> <span class="token variable">@CountryIN</span>   <span class="token punctuation">)</span>  <span class="token keyword">Group</span> <span class="token keyword">by</span> ProductID  <span class="token keyword">ORDER</span> <span class="token keyword">by</span> <span class="token function">Sum</span><span class="token punctuation">(</span>Quantity<span class="token punctuation">)</span>  <span class="token keyword">SET</span> <span class="token variable">@MaxNumIn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>SumQuantity<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token comment">#mytemp)--从临时表#mytemp中获得某个国家客户中最大销量的产品的销量数目</span>  <span class="token comment">--下面需要分情况讨论</span>  <span class="token comment">--如果对应于这个最大值的@MaxNumIn只有一个产品编号，那么就找出这个产品id的名称，并且插入临时表#tempcursor一行统计结果  </span>  <span class="token keyword">IF</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">Count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> ProductID <span class="token keyword">FROM</span> <span class="token comment">#mytemp WHERE SumQuantity = @MaxNumIn) = 1</span>  <span class="token keyword">BEGIN</span>    <span class="token keyword">SET</span> <span class="token variable">@ProductIDIN</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">Top</span> <span class="token number">1</span> ProductID <span class="token keyword">FROM</span> <span class="token comment">#mytemp WHERE SumQuantity = @MaxNumIn)</span>    <span class="token keyword">SET</span> <span class="token variable">@ProductNameIN</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> ProductName <span class="token keyword">FROM</span> Products <span class="token keyword">WHERE</span> ProductID <span class="token operator">=</span> <span class="token variable">@ProductIDIN</span><span class="token punctuation">)</span>    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token comment">#tempcursor VAlues(@CountryIN,@ProductNameIN)  </span>  <span class="token keyword">END</span>   <span class="token comment">--如果对应于这个最大值的@MaxNumIn有多个产品编号，那么就是销量最大的产品出现了并列第一</span>  <span class="token comment">--那么在这多个并列第一的产品集合中，再建立另外游标，来逐个读取并列第一的产品名称，并且插入临时表#tempcursor </span>  <span class="token keyword">IF</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">Count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> ProductID <span class="token keyword">FROM</span> <span class="token comment">#mytemp WHERE SumQuantity = @MaxNumIn) > 1</span>  <span class="token keyword">BEGIN</span>     <span class="token keyword">DECLARE</span> innercursor <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span> <span class="token keyword">SELECT</span> ProductID <span class="token keyword">FROM</span> <span class="token comment">#mytemp WHERE SumQuantity = @MaxNumIn </span>     <span class="token keyword">OPEN</span> innercursor     <span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> innercursor <span class="token keyword">INTO</span> <span class="token variable">@ProductIDIN</span>     <span class="token keyword">WHILE</span> @<span class="token variable">@FETCH_STATUS</span> <span class="token operator">=</span> <span class="token number">0</span>     <span class="token keyword">BEGIN</span>        <span class="token keyword">SET</span> <span class="token variable">@ProductNameIN</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> ProductName <span class="token keyword">FROM</span> Products <span class="token keyword">WHERE</span> ProductID <span class="token operator">=</span> <span class="token variable">@ProductIDIN</span><span class="token punctuation">)</span>        <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token comment">#tempcursor VAlues(@CountryIN,@ProductNameIN + ' 并列第一')  </span>        <span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> innercursor <span class="token keyword">INTO</span> <span class="token variable">@ProductIDIN</span>    <span class="token keyword">END</span>    <span class="token keyword">CLOSE</span> innercursor    <span class="token keyword">DEALLOCATE</span> innercursor  <span class="token keyword">END</span>       <span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token comment">#mytemp--删除这个mytemp临时表</span>       <span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> mycursor <span class="token keyword">INTO</span> <span class="token variable">@CountryIN</span><span class="token comment">--进入下一个循环</span><span class="token keyword">END</span><span class="token keyword">CLOSE</span> mycursor        <span class="token comment">--关闭游标</span><span class="token keyword">DEALLOCATE</span> mycursor<span class="token comment">--释放游标</span><span class="token keyword">SELECT</span> CountryName <span class="token keyword">as</span> <span class="token string">'国家名称'</span><span class="token punctuation">,</span> ProductName <span class="token keyword">as</span> <span class="token string">'该国最受欢迎产品奖'</span> <span class="token keyword">from</span> <span class="token comment">#tempCursor</span><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token comment">#tempcursor--删除结果集合的临时表</span><span class="token comment">--运行实例</span><span class="token keyword">EXEC</span> p_LovestOfContry<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Stored-Procedures"><a href="#Stored-Procedures" class="headerlink" title="Stored Procedures"></a>Stored Procedures</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">---------------------------存储过程------------------------</span><span class="token keyword">SELECT</span> t<span class="token punctuation">.</span>title<span class="token punctuation">,</span> t<span class="token punctuation">.</span>price<span class="token punctuation">,</span> p<span class="token punctuation">.</span>pub_name<span class="token keyword">FROM</span> titles <span class="token keyword">as</span> t <span class="token keyword">inner</span> <span class="token keyword">join</span> publishers <span class="token keyword">as</span> p <span class="token keyword">on</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> p<span class="token punctuation">.</span>pub_id<span class="token punctuation">)</span><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> vtttt<span class="token keyword">AS</span><span class="token keyword">SELECT</span> t<span class="token punctuation">.</span>title<span class="token punctuation">,</span> t<span class="token punctuation">.</span>price<span class="token punctuation">,</span> p<span class="token punctuation">.</span>pub_name<span class="token keyword">FROM</span> titles <span class="token keyword">as</span> t <span class="token keyword">inner</span> <span class="token keyword">join</span> publishers <span class="token keyword">as</span> p <span class="token keyword">on</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> p<span class="token punctuation">.</span>pub_id<span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> vtttt<span class="token keyword">WHERE</span> title <span class="token operator">like</span> <span class="token string">'%computer%'</span><span class="token keyword">DECLARE</span>   <span class="token variable">@myinputtitlename</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token keyword">SET</span> <span class="token variable">@myinputtitlename</span> <span class="token operator">=</span> <span class="token string">'computer'</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> vtttt<span class="token keyword">WHERE</span> title <span class="token operator">like</span> <span class="token string">'%'</span> <span class="token operator">+</span> <span class="token variable">@myinputtitlename</span> <span class="token operator">+</span> <span class="token string">'%'</span><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> p_first   <span class="token variable">@myinputtitlename</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token keyword">AS</span><span class="token keyword">BEGIN</span><span class="token keyword">SELECT</span> t<span class="token punctuation">.</span>title<span class="token punctuation">,</span> t<span class="token punctuation">.</span>price<span class="token punctuation">,</span> p<span class="token punctuation">.</span>pub_name<span class="token keyword">FROM</span> titles <span class="token keyword">as</span> t <span class="token keyword">inner</span> <span class="token keyword">join</span> publishers <span class="token keyword">as</span> p <span class="token keyword">on</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> p<span class="token punctuation">.</span>pub_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> title <span class="token operator">like</span> <span class="token string">'%'</span> <span class="token operator">+</span> <span class="token variable">@myinputtitlename</span> <span class="token operator">+</span> <span class="token string">'%'</span><span class="token keyword">END</span><span class="token keyword">EXEC</span> p_first <span class="token string">'t'</span><span class="token comment">--输入一个作者名字，得到这个作者的写的书，单价，出版社</span><span class="token keyword">ALTER</span> <span class="token keyword">PROCEDURE</span> p_second   <span class="token variable">@myinputauthorname</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token keyword">AS</span><span class="token keyword">BEGIN</span><span class="token keyword">SELECT</span>  dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>title<span class="token punctuation">,</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>price<span class="token punctuation">,</span> dbo<span class="token punctuation">.</span>publishers<span class="token punctuation">.</span>pub_name<span class="token keyword">FROM</span>      dbo<span class="token punctuation">.</span>titleauthor <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>                   dbo<span class="token punctuation">.</span>titles <span class="token keyword">ON</span> dbo<span class="token punctuation">.</span>titleauthor<span class="token punctuation">.</span>title_id <span class="token operator">=</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>title_id <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>                   dbo<span class="token punctuation">.</span>publishers <span class="token keyword">ON</span> dbo<span class="token punctuation">.</span>titles<span class="token punctuation">.</span>pub_id <span class="token operator">=</span> dbo<span class="token punctuation">.</span>publishers<span class="token punctuation">.</span>pub_id <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>                   dbo<span class="token punctuation">.</span>authors <span class="token keyword">ON</span> dbo<span class="token punctuation">.</span>titleauthor<span class="token punctuation">.</span>au_id <span class="token operator">=</span> dbo<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>au_id<span class="token keyword">WHERE</span> authors<span class="token punctuation">.</span>au_fname <span class="token operator">like</span> <span class="token string">'%'</span> <span class="token operator">+</span> <span class="token variable">@myinputauthorname</span> <span class="token operator">+</span> <span class="token string">'%'</span>       <span class="token operator">or</span> authors<span class="token punctuation">.</span>au_fname <span class="token operator">like</span> <span class="token string">'%'</span> <span class="token operator">+</span> <span class="token variable">@myinputauthorname</span> <span class="token operator">+</span> <span class="token string">'%'</span><span class="token keyword">END</span><span class="token keyword">EXEC</span> p_second <span class="token string">'Sher'</span>多个参数输出参数（返回值）流程控制变量定义输入一个开始时间，一个结束时间返回这个阶段的书的销售记录<span class="token punctuation">,</span>包括；书名字，日期，卖出去数量<span class="token keyword">SELECT</span> title<span class="token punctuation">,</span>ord_date<span class="token punctuation">,</span>qty <span class="token keyword">FROM</span> Sales <span class="token keyword">inner</span> <span class="token keyword">join</span> titles <span class="token keyword">on</span> <span class="token punctuation">(</span>sales<span class="token punctuation">.</span>title_id <span class="token operator">=</span> titles<span class="token punctuation">.</span>title_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> ord_date <span class="token operator">between</span> <span class="token string">'1994-9-1'</span> <span class="token operator">and</span> <span class="token string">'1994-10-1'</span><span class="token operator">-</span><span class="token number">2</span>个变量<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> p_third   <span class="token variable">@inputbegin</span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>   <span class="token variable">@inputend</span> <span class="token keyword">datetime</span><span class="token keyword">AS</span><span class="token keyword">BEGIN</span><span class="token keyword">SELECT</span> title<span class="token punctuation">,</span>ord_date<span class="token punctuation">,</span>qty <span class="token keyword">FROM</span> Sales <span class="token keyword">inner</span> <span class="token keyword">join</span> titles <span class="token keyword">on</span> <span class="token punctuation">(</span>sales<span class="token punctuation">.</span>title_id <span class="token operator">=</span> titles<span class="token punctuation">.</span>title_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> ord_date <span class="token operator">between</span> <span class="token variable">@inputbegin</span> <span class="token operator">and</span> <span class="token variable">@inputend</span><span class="token keyword">END</span><span class="token keyword">EXEC</span> p_third <span class="token string">'1994-9-1'</span><span class="token punctuation">,</span> <span class="token string">'1994-10-1'</span><span class="token operator">-</span>默认值<span class="token keyword">Alter</span> <span class="token keyword">PROCEDURE</span> p_third   <span class="token variable">@inputbegin</span> <span class="token keyword">datetime</span> <span class="token operator">=</span> <span class="token string">'1994-9-1'</span><span class="token punctuation">,</span>   <span class="token variable">@inputend</span> <span class="token keyword">datetime</span> <span class="token operator">=</span> <span class="token string">'1994-10-1'</span><span class="token keyword">AS</span><span class="token keyword">BEGIN</span><span class="token keyword">SELECT</span> title<span class="token punctuation">,</span>ord_date<span class="token punctuation">,</span>qty <span class="token keyword">FROM</span> Sales <span class="token keyword">inner</span> <span class="token keyword">join</span> titles <span class="token keyword">on</span> <span class="token punctuation">(</span>sales<span class="token punctuation">.</span>title_id <span class="token operator">=</span> titles<span class="token punctuation">.</span>title_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> ord_date <span class="token operator">between</span> <span class="token variable">@inputbegin</span> <span class="token operator">and</span> <span class="token variable">@inputend</span><span class="token keyword">END</span><span class="token keyword">EXEC</span> p_third <span class="token string">'1994-9-14'</span><span class="token punctuation">,</span> <span class="token string">'1994-11-1'</span><span class="token operator">-</span>流程控制，变量控制  如果没有，就返回最近<span class="token number">3</span>条<span class="token keyword">Alter</span> <span class="token keyword">PROCEDURE</span> p_third   <span class="token variable">@inputbegin</span> <span class="token keyword">datetime</span> <span class="token operator">=</span> <span class="token string">'1994-9-1'</span><span class="token punctuation">,</span>   <span class="token variable">@inputend</span> <span class="token keyword">datetime</span> <span class="token operator">=</span> <span class="token string">'1994-10-1'</span><span class="token keyword">AS</span><span class="token keyword">BEGIN</span>   <span class="token keyword">DECLARE</span> <span class="token variable">@mycontrol</span> <span class="token keyword">int</span>  <span class="token keyword">SET</span> <span class="token variable">@mycontrol</span> <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> sales <span class="token keyword">WHERE</span> ord_date <span class="token operator">between</span> <span class="token variable">@inputbegin</span> <span class="token operator">and</span> <span class="token variable">@inputend</span><span class="token punctuation">)</span>  <span class="token keyword">IF</span> <span class="token variable">@mycontrol</span> <span class="token operator">></span> <span class="token number">0</span>  <span class="token keyword">BEGIN</span><span class="token keyword">SELECT</span> title<span class="token punctuation">,</span>ord_date<span class="token punctuation">,</span>qty <span class="token keyword">FROM</span> Sales <span class="token keyword">inner</span> <span class="token keyword">join</span> titles <span class="token keyword">on</span> <span class="token punctuation">(</span>sales<span class="token punctuation">.</span>title_id <span class="token operator">=</span> titles<span class="token punctuation">.</span>title_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> ord_date <span class="token operator">between</span> <span class="token variable">@inputbegin</span> <span class="token operator">and</span> <span class="token variable">@inputend</span>  <span class="token keyword">END</span>   <span class="token keyword">ELSE</span>  <span class="token keyword">BEGIN</span><span class="token keyword">SELECT</span> <span class="token keyword">TOP</span> <span class="token number">3</span> title<span class="token punctuation">,</span>ord_date<span class="token punctuation">,</span>qty <span class="token keyword">FROM</span> Sales <span class="token keyword">inner</span> <span class="token keyword">join</span> titles <span class="token keyword">on</span> <span class="token punctuation">(</span>sales<span class="token punctuation">.</span>title_id <span class="token operator">=</span> titles<span class="token punctuation">.</span>title_id<span class="token punctuation">)</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ord_date <span class="token keyword">DESC</span>  <span class="token keyword">END</span><span class="token keyword">END</span><span class="token keyword">EXEC</span> p_third <span class="token string">'1994-10-14'</span><span class="token punctuation">,</span> <span class="token string">'1994-11-1'</span><span class="token comment">--上面查询继续，增加内容：请同时返回本次查询的结果的记录条数+总销售本书</span><span class="token keyword">Alter</span> <span class="token keyword">PROCEDURE</span> p_third   <span class="token variable">@inputbegin</span> <span class="token keyword">datetime</span> <span class="token operator">=</span> <span class="token string">'1994-9-1'</span><span class="token punctuation">,</span>   <span class="token variable">@inputend</span> <span class="token keyword">datetime</span> <span class="token operator">=</span> <span class="token string">'1994-10-1'</span><span class="token punctuation">,</span>   <span class="token variable">@outputcount</span> <span class="token keyword">int</span> OUTPUT<span class="token punctuation">,</span>   <span class="token variable">@outputsum</span>   <span class="token keyword">int</span> OUTPUT<span class="token keyword">AS</span><span class="token keyword">BEGIN</span>   <span class="token keyword">DECLARE</span> <span class="token variable">@mycontrol</span> <span class="token keyword">int</span>  <span class="token keyword">SET</span> <span class="token variable">@mycontrol</span> <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> sales <span class="token keyword">WHERE</span> ord_date <span class="token operator">between</span> <span class="token variable">@inputbegin</span> <span class="token operator">and</span> <span class="token variable">@inputend</span><span class="token punctuation">)</span>  <span class="token keyword">SET</span> <span class="token variable">@outputcount</span> <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> sales <span class="token keyword">WHERE</span> ord_date <span class="token operator">between</span> <span class="token variable">@inputbegin</span> <span class="token operator">and</span> <span class="token variable">@inputend</span><span class="token punctuation">)</span>  <span class="token keyword">SET</span> <span class="token variable">@outputsum</span> <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>qty<span class="token punctuation">)</span> <span class="token keyword">FROM</span> sales <span class="token keyword">WHERE</span> ord_date <span class="token operator">between</span> <span class="token variable">@inputbegin</span> <span class="token operator">and</span> <span class="token variable">@inputend</span><span class="token punctuation">)</span>  <span class="token keyword">IF</span> <span class="token variable">@mycontrol</span> <span class="token operator">></span> <span class="token number">0</span>  <span class="token keyword">BEGIN</span><span class="token keyword">SELECT</span> title<span class="token punctuation">,</span>ord_date<span class="token punctuation">,</span>qty <span class="token keyword">FROM</span> Sales <span class="token keyword">inner</span> <span class="token keyword">join</span> titles <span class="token keyword">on</span> <span class="token punctuation">(</span>sales<span class="token punctuation">.</span>title_id <span class="token operator">=</span> titles<span class="token punctuation">.</span>title_id<span class="token punctuation">)</span><span class="token keyword">WHERE</span> ord_date <span class="token operator">between</span> <span class="token variable">@inputbegin</span> <span class="token operator">and</span> <span class="token variable">@inputend</span>  <span class="token keyword">END</span>   <span class="token keyword">ELSE</span>  <span class="token keyword">BEGIN</span><span class="token keyword">SELECT</span> <span class="token keyword">TOP</span> <span class="token number">3</span> title<span class="token punctuation">,</span>ord_date<span class="token punctuation">,</span>qty <span class="token keyword">FROM</span> Sales <span class="token keyword">inner</span> <span class="token keyword">join</span> titles <span class="token keyword">on</span> <span class="token punctuation">(</span>sales<span class="token punctuation">.</span>title_id <span class="token operator">=</span> titles<span class="token punctuation">.</span>title_id<span class="token punctuation">)</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ord_date <span class="token keyword">DESC</span><span class="token keyword">SET</span> <span class="token variable">@outputcount</span> <span class="token operator">=</span>  <span class="token number">3</span>    <span class="token keyword">SET</span> <span class="token variable">@outputsum</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token keyword">END</span><span class="token keyword">END</span><span class="token comment">---</span><span class="token keyword">DECLARE</span>  <span class="token variable">@getoutputcount</span> <span class="token keyword">int</span><span class="token punctuation">,</span>  <span class="token variable">@getoutputsum</span> <span class="token keyword">int</span><span class="token keyword">EXEC</span> p_third <span class="token string">'1994-9-20'</span><span class="token punctuation">,</span> <span class="token string">'1994-10-1'</span><span class="token punctuation">,</span> <span class="token variable">@getoutputcount</span> OUTPUT<span class="token punctuation">,</span> <span class="token variable">@getoutputsum</span> OUTPUT<span class="token keyword">SELECT</span> <span class="token variable">@getoutputcount</span><span class="token punctuation">,</span> <span class="token variable">@getoutputsum</span><span class="token operator">-</span>输入作者姓名，返回这个作者写的书的书名字，出版社，单价，销量同时要能知道，这个作者写了几本书，总销量是多少如果没有找到作者，返回销量最高的<span class="token number">3</span>本书<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Triggers"><a href="#Triggers" class="headerlink" title="Triggers"></a>Triggers</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">---------------------------------------------------------------------------</span><span class="token comment">--触发器的基本语法</span><span class="token comment">---------------------------------------------------------------------------</span><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> <span class="token operator">&lt;</span>trigger_name<span class="token punctuation">,</span> sysname<span class="token punctuation">,</span> trig_test<span class="token operator">></span><span class="token keyword">ON</span> <span class="token operator">&lt;</span>table_name<span class="token punctuation">,</span> sysname<span class="token punctuation">,</span> pubs<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>sales<span class="token operator">></span><span class="token keyword">FOR</span> <span class="token keyword">DELETE</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">UPDATE</span> <span class="token keyword">AS</span> <span class="token keyword">BEGIN</span><span class="token keyword">RAISERROR</span> <span class="token punctuation">(</span><span class="token number">50009</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword">END</span><span class="token comment">--------------------------------------------------------------------------</span><span class="token comment">--简单的删除触发器</span><span class="token comment">--------------------------------------------------------------------------</span><span class="token comment">--建立一个简单的和其他表没有任何关系的表，避免删除时和其他表的联系</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">INTO</span> AAA<span class="token keyword">FROM</span> Title<span class="token keyword">create</span> <span class="token keyword">trigger</span> t_DelAAADoSomething<span class="token keyword">ON</span> AAA<span class="token keyword">FOR</span> <span class="token keyword">Delete</span><span class="token keyword">AS</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Just Now You Del a Recorder of AAA table'</span><span class="token punctuation">)</span><span class="token comment">--运行删除语句就会激发上面这个触发器(输出一次print，影响1行)</span><span class="token keyword">delete</span> aaa<span class="token keyword">where</span> title_id <span class="token operator">=</span> <span class="token string">'bu1032'</span><span class="token comment">--运行删除语句就会激发上面这个触发器(输出一次print，影响17行)</span><span class="token keyword">delete</span> aaa<span class="token comment">--还原aaa表数据 </span><span class="token keyword">insert</span> <span class="token keyword">into</span> aaa<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> titles<span class="token keyword">create</span> <span class="token keyword">trigger</span> t_DelAAADoSomethingAndDoAgain<span class="token keyword">ON</span> aaa<span class="token keyword">FOR</span> <span class="token keyword">Delete</span><span class="token keyword">AS</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Just now you run del and run  t_DelaaaDoSomethingAndDoAgain'</span><span class="token punctuation">)</span><span class="token comment">--运行删除语句就会激发上面这二个触发器</span><span class="token keyword">delete</span> aaa<span class="token keyword">where</span> title_id <span class="token operator">=</span> <span class="token string">'bu1032'</span><span class="token comment">/*Just Now You Del a Recorder of AAA tableJust now you run del and run  t_DelaaaDoSomethingAndDoAgain（所影响的行数为 1 行）*/</span><span class="token keyword">delete</span> aaa<span class="token comment">/*Just Now You Del a Recorder of AAA tableJust now you run del and run  t_DelaaaDoSomethingAndDoAgain（所影响的行数为 17 行）*/</span><span class="token comment">--------------------------------------------------------------------------</span><span class="token comment">--简单的更新和插入触发器</span><span class="token comment">--------------------------------------------------------------------------</span><span class="token keyword">create</span> <span class="token keyword">trigger</span> t_UpdateAAADosomthing<span class="token keyword">ON</span> aaa<span class="token keyword">FOR</span> <span class="token keyword">Update</span><span class="token punctuation">,</span><span class="token keyword">Insert</span><span class="token keyword">AS</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Just now you Update or insert aaa table'</span><span class="token punctuation">)</span><span class="token comment">--还原aaa表数据 </span><span class="token keyword">insert</span> <span class="token keyword">into</span> aaa<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> titles<span class="token comment">--执行一行更新语句</span><span class="token keyword">update</span> aaa<span class="token keyword">set</span> price <span class="token operator">=</span> price <span class="token operator">+</span> <span class="token number">0.1</span><span class="token comment">/*Just now you Update or insert aaa table（所影响的行数为 18 行）*/</span><span class="token comment">--------------------------------------------------------------------------</span><span class="token comment">--从临时删除表中读取刚才删除的纪录信息 SELECT title FROM deleted</span><span class="token comment">--每当对某个表执行delete时都会生成和某个表结构一样的一个临时表deleted</span><span class="token comment">--每当对某个表执行update，insert时都会生成和某个表结构一样的一个临时表inserted</span><span class="token comment">--可以利用这二个临时表来活动最近一次delete，insert，update的数据</span><span class="token comment">--------------------------------------------------------------------------</span><span class="token keyword">create</span> <span class="token keyword">trigger</span> t_DelAAADoDetail<span class="token keyword">ON</span> AAA<span class="token keyword">FOR</span> <span class="token keyword">Delete</span><span class="token keyword">AS</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Just Now You Del a Recorder of AAA table'</span><span class="token punctuation">)</span><span class="token keyword">Declare</span>   <span class="token variable">@title</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token keyword">SET</span> <span class="token variable">@title</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> title <span class="token keyword">FROM</span> deleted<span class="token punctuation">)</span><span class="token keyword">PRINT</span> <span class="token string">'" '</span> <span class="token operator">+</span> <span class="token variable">@title</span> <span class="token operator">+</span> <span class="token string">' " : is your just del book name '</span><span class="token comment">--删除一行纪录</span><span class="token keyword">delete</span> aaa<span class="token keyword">where</span> title_id <span class="token operator">=</span> <span class="token string">'PC1035'</span> <span class="token comment">/*Just Now You Del a Recorder of AAA tableJust now you run del and run  t_DelaaaDoSomethingAndDoAgainJust Now You Del a Recorder of AAA table（所影响的行数为 1 行）" But Is It User Friendly? " : is your just del book name */</span><span class="token comment">--删除多行纪录，有问题，游标</span><span class="token keyword">delete</span> aaa<span class="token keyword">where</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'business'</span> <span class="token comment">/*Just Now You Del a Recorder of AAA tableJust now you run del and run  t_DelaaaDoSomethingAndDoAgainJust Now You Del a Recorder of AAA table服务器: 消息 512，级别 16，状态 1，过程 t_DelAAADoDetail，行 10子查询返回的值多于一个。当子查询跟随在 =、!=、&lt;、&lt;=、>、>= 之后，或子查询用作表达式时，这种情况是不允许的。语句已终止。*/</span><span class="token comment">--------------------------------------------------------------------------</span><span class="token comment">--每次添加一本书的销售纪录就要修改这本书的总销量</span><span class="token comment">--------------------------------------------------------------------------</span><span class="token keyword">CREATE</span> <span class="token keyword">trigger</span> t_AddSalesANDAddYtd_Sales<span class="token keyword">ON</span> Sales<span class="token keyword">FOR</span> <span class="token keyword">Insert</span><span class="token keyword">AS</span> <span class="token keyword">declare</span>   <span class="token variable">@NewYtdSales</span> <span class="token keyword">int</span><span class="token punctuation">,</span>   <span class="token variable">@NewSalesTitleID</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>   <span class="token keyword">SET</span> <span class="token variable">@NewYtdSales</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> qty <span class="token keyword">FROM</span> Inserted<span class="token punctuation">)</span>   <span class="token keyword">SET</span> <span class="token variable">@NewSalesTitleID</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> title_id <span class="token keyword">From</span> INSERTED<span class="token punctuation">)</span>   <span class="token keyword">UPDATE</span> Titles   <span class="token keyword">SET</span> Ytd_Sales <span class="token operator">=</span> Ytd_Sales <span class="token operator">+</span> <span class="token variable">@NewYtdSales</span>   <span class="token keyword">WHERE</span> title_id <span class="token operator">=</span> <span class="token variable">@NewSalesTitleID</span><span class="token keyword">INSERT</span> sales<span class="token keyword">Values</span><span class="token punctuation">(</span><span class="token number">6380</span><span class="token punctuation">,</span><span class="token number">23456</span><span class="token punctuation">,</span><span class="token string">'1999-1-1'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token string">'Net 60'</span><span class="token punctuation">,</span><span class="token string">'BU1032'</span><span class="token punctuation">)</span><span class="token comment">/*----------------------------------------------------------------------------察看触发器的方法：触发器总是和表相关联的在企业管理器中选中一个表，从右键菜单的所有任务中选择“管理触发器”--通过修改表的性质 允许和禁止触发器--------------------------------------------------------------------------*/</span><span class="token keyword">use</span> pubs<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employee      <span class="token keyword">DISABLE</span> <span class="token keyword">Trigger</span> employee_insupd<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employee      <span class="token keyword">ENABLE</span> <span class="token keyword">Trigger</span> employee_insupd<span class="token comment">--------------------------------------------------------------------------</span><span class="token comment">--练习</span><span class="token comment">--每次添加一本书的销售纪录就要给写书的作者1元钱的版权费</span><span class="token comment">--------------------------------------------------------------------------</span><span class="token keyword">CREATE</span> <span class="token keyword">trigger</span> t_AddSalesANDAddRoyaltyper<span class="token keyword">ON</span> Sales<span class="token keyword">FOR</span> <span class="token keyword">Insert</span><span class="token keyword">AS</span> <span class="token keyword">declare</span>   <span class="token variable">@NewYtdSales</span> <span class="token keyword">int</span><span class="token punctuation">,</span>   <span class="token variable">@NewSalesTitleID</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>   <span class="token keyword">SET</span> <span class="token variable">@NewYtdSales</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> qty <span class="token keyword">FROM</span> Inserted<span class="token punctuation">)</span>   <span class="token keyword">SET</span> <span class="token variable">@NewSalesTitleID</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> title_id <span class="token keyword">From</span> INSERTED<span class="token punctuation">)</span>   <span class="token keyword">UPDATE</span> TitleAuthor   <span class="token keyword">SET</span> royaltyper <span class="token operator">=</span> royaltyper <span class="token operator">+</span> <span class="token variable">@NewYtdSales</span>   <span class="token keyword">WHERE</span> title_id <span class="token operator">=</span> <span class="token variable">@NewSalesTitleID</span><span class="token keyword">INSERT</span> sales<span class="token keyword">Values</span><span class="token punctuation">(</span><span class="token number">6380</span><span class="token punctuation">,</span><span class="token number">2349</span><span class="token punctuation">,</span><span class="token string">'1999-1-1'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token string">'Net 60'</span><span class="token punctuation">,</span><span class="token string">'TC7777'</span><span class="token punctuation">)</span><span class="token comment">--------------------------------------------------------------------------</span><span class="token comment">--附加练习（SQL Server的pubs数据库自带例子）（带逻辑、带错误检验、带事务控制）</span><span class="token comment">--添加一个雇员的时候使用触发器控制用户录入的雇员的job_lvl必须在max_lvl与min_lvl中间</span><span class="token comment">--------------------------------------------------------------------------</span><span class="token keyword">drop</span> <span class="token keyword">trigger</span> employee_insupd<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> employee_insupd<span class="token keyword">ON</span> employee<span class="token keyword">FOR</span> <span class="token keyword">insert</span><span class="token keyword">AS</span><span class="token comment">--声明变量.</span>  <span class="token keyword">declare</span><span class="token variable">@min_lvl</span> <span class="token keyword">tinyint</span><span class="token punctuation">,</span>   <span class="token variable">@max_lvl</span> <span class="token keyword">tinyint</span><span class="token punctuation">,</span>   <span class="token variable">@emp_lvl</span> <span class="token keyword">tinyint</span><span class="token punctuation">,</span>   <span class="token variable">@job_id</span> <span class="token keyword">smallint</span>  <span class="token comment">--为变量赋值，就是刚才获取insert的这个雇员，用户输入的信息</span><span class="token keyword">select</span> <span class="token variable">@min_lvl</span> <span class="token operator">=</span> min_lvl<span class="token punctuation">,</span>   <span class="token variable">@max_lvl</span> <span class="token operator">=</span> max_lvl<span class="token punctuation">,</span>    <span class="token variable">@emp_lvl</span> <span class="token operator">=</span> i<span class="token punctuation">.</span>job_lvl<span class="token punctuation">,</span>    <span class="token variable">@job_id</span> <span class="token operator">=</span> i<span class="token punctuation">.</span>job_id<span class="token keyword">from</span> employee e<span class="token punctuation">,</span> jobs j<span class="token punctuation">,</span> inserted i<span class="token keyword">where</span> e<span class="token punctuation">.</span>emp_id <span class="token operator">=</span> i<span class="token punctuation">.</span>emp_id <span class="token operator">AND</span> i<span class="token punctuation">.</span>job_id <span class="token operator">=</span> j<span class="token punctuation">.</span>job_id<span class="token comment">--使用Raiserror，发出错误信息，放弃本次添加，就是回滚事物，本次添加无效</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token punctuation">(</span><span class="token variable">@emp_lvl</span> <span class="token operator">BETWEEN</span> <span class="token variable">@min_lvl</span> <span class="token operator">AND</span> <span class="token variable">@max_lvl</span><span class="token punctuation">)</span><span class="token keyword">begin</span>   <span class="token keyword">raiserror</span> <span class="token punctuation">(</span><span class="token string">'The level for job_id:%d should be between %d and %d.'</span><span class="token punctuation">,</span>      <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">@job_id</span><span class="token punctuation">,</span> <span class="token variable">@min_lvl</span><span class="token punctuation">,</span> <span class="token variable">@max_lvl</span><span class="token punctuation">)</span>   <span class="token keyword">ROLLBACK</span> <span class="token keyword">TRANSACTION</span><span class="token keyword">end</span><span class="token comment">--不发出错误信息，直接把用户错误的输入纠正为最大值或最小值</span><span class="token keyword">CREATE</span> <span class="token keyword">trigger</span> t_AddSalesCheckJob_lvl<span class="token keyword">ON</span> employee<span class="token keyword">FOR</span> <span class="token keyword">Insert</span><span class="token keyword">AS</span><span class="token keyword">declare</span>   <span class="token variable">@job_id</span> <span class="token keyword">int</span><span class="token punctuation">,</span>   <span class="token variable">@job_lvl</span> <span class="token keyword">int</span><span class="token punctuation">,</span>   <span class="token variable">@emp_id</span> empid<span class="token punctuation">,</span>   <span class="token variable">@min_lvl</span> <span class="token keyword">int</span><span class="token punctuation">,</span>   <span class="token variable">@max_lvl</span> <span class="token keyword">int</span>    <span class="token keyword">SET</span> <span class="token variable">@job_id</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> job_id <span class="token keyword">FROM</span> INSERTED<span class="token punctuation">)</span>  <span class="token keyword">SET</span> <span class="token variable">@job_lvl</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> job_lvl <span class="token keyword">FROM</span> INSERTED<span class="token punctuation">)</span>  <span class="token keyword">SET</span> <span class="token variable">@emp_id</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> emp_id <span class="token keyword">FROM</span> INSERTED<span class="token punctuation">)</span>  <span class="token keyword">SET</span> <span class="token variable">@Min_lvl</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> min_lvl <span class="token keyword">FROM</span> jobs <span class="token keyword">WHERE</span> job_id <span class="token operator">=</span> <span class="token variable">@job_id</span><span class="token punctuation">)</span>  <span class="token keyword">SET</span> <span class="token variable">@Max_lvl</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> max_lvl <span class="token keyword">FROM</span> jobs <span class="token keyword">WHERE</span> job_id <span class="token operator">=</span> <span class="token variable">@job_id</span><span class="token punctuation">)</span>  <span class="token keyword">If</span> <span class="token variable">@job_lvl</span> <span class="token operator">&lt;</span><span class="token variable">@Min_lvl</span>  <span class="token keyword">BEGIN</span>    <span class="token keyword">UPDATE</span> employee     <span class="token keyword">SET</span> job_lvl <span class="token operator">=</span> <span class="token variable">@Min_lvl</span>    <span class="token keyword">WHERE</span> emp_id <span class="token operator">=</span> <span class="token variable">@emp_id</span>   <span class="token keyword">END</span>  <span class="token keyword">If</span> <span class="token variable">@job_lvl</span> <span class="token operator">></span><span class="token variable">@Max_lvl</span>  <span class="token keyword">BEGIN</span>    <span class="token keyword">UPDATE</span> employee     <span class="token keyword">SET</span> job_lvl <span class="token operator">=</span> <span class="token variable">@Man_lvl</span>    <span class="token keyword">WHERE</span> emp_id <span class="token operator">=</span> <span class="token variable">@emp_id</span>   <span class="token keyword">END</span><span class="token keyword">INSERT</span> employee<span class="token keyword">Values</span><span class="token punctuation">(</span><span class="token string">'PPP42628F'</span><span class="token punctuation">,</span><span class="token string">'aaa'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'bbb'</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'0877'</span><span class="token punctuation">,</span><span class="token string">'1992-1-1'</span><span class="token punctuation">)</span><span class="token comment">-- =============================================</span><span class="token comment">-- 使用存在检测功能</span><span class="token comment">-- =============================================</span><span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> name    <span class="token keyword">FROM</span>   sysobjects    <span class="token keyword">WHERE</span>  name <span class="token operator">=</span> <span class="token string">'aaabbb'</span>   <span class="token operator">AND</span>   <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'P'</span><span class="token punctuation">)</span>    <span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>aaabbb<span class="token punctuation">]</span>GO<span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> name    <span class="token keyword">FROM</span>   sysobjects    <span class="token keyword">WHERE</span>  name <span class="token operator">=</span> N<span class="token string">'&lt;trigger_name, sysname, trig_test>'</span>    <span class="token operator">AND</span>   <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'TR'</span><span class="token punctuation">)</span>    <span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> <span class="token operator">&lt;</span>trigger_name<span class="token punctuation">,</span> sysname<span class="token punctuation">,</span> trig_test<span class="token operator">></span>GO<span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> name    <span class="token keyword">FROM</span>   sysobjects    <span class="token keyword">WHERE</span>  name <span class="token operator">=</span> N<span class="token string">'&lt;procedure_name, sysname, proc_test>'</span>    <span class="token operator">AND</span>   <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'P'</span><span class="token punctuation">)</span>    <span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token operator">&lt;</span>procedure_name<span class="token punctuation">,</span> sysname<span class="token punctuation">,</span> proc_test<span class="token operator">></span>GO<span class="token keyword">IF</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> name   <span class="token keyword">FROM</span>  sysobjects   <span class="token keyword">WHERE</span>  name <span class="token operator">=</span> N<span class="token string">'&lt;table_name, sysname, test_table>'</span>   <span class="token operator">AND</span>  <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'U'</span><span class="token punctuation">)</span>    <span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span>table_name<span class="token punctuation">,</span> sysname<span class="token punctuation">,</span> test_table<span class="token operator">></span>GO<span class="token keyword">USE</span> pubs<span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> sysobjects       <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'au_info2'</span> <span class="token operator">AND</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'P'</span><span class="token punctuation">)</span>   <span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> au_info2GO<span class="token keyword">USE</span> pubs<span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> sysobjects      <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'reminder'</span> <span class="token operator">AND</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">'TR'</span><span class="token punctuation">)</span>   <span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> reminderGO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="关系代数"><a href="#关系代数" class="headerlink" title="关系代数"></a>关系代数</h2><h3 id="关系代数运算符"><a href="#关系代数运算符" class="headerlink" title="关系代数运算符"></a>关系代数运算符</h3><h4 id="集合运算符"><a href="#集合运算符" class="headerlink" title="集合运算符"></a>集合运算符</h4><p>并、差、交、广义笛卡尔积</p><h4 id="专门的关系运算符"><a href="#专门的关系运算符" class="headerlink" title="专门的关系运算符"></a>专门的关系运算符</h4><p>选择、投影、连接、除</p><h4 id="算术比较符"><a href="#算术比较符" class="headerlink" title="算术比较符"></a>算术比较符</h4><h4 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h4><h3 id="专门的关系运算"><a href="#专门的关系运算" class="headerlink" title="专门的关系运算"></a>专门的关系运算</h3><h4 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h4><p>类似于SELECT*-WHERE</p><p>$\sigma_F(R),其中F是选择运算符，是一个逻辑表达式$</p><p>如：$\sigma_{Sdept&#x3D;’IS’}(Student)$</p><h4 id="投影"><a href="#投影" class="headerlink" title="投影"></a>投影</h4><p>类似于SELECT…FROM</p><p>$\Pi_A(R),其中A是R中的属性列$</p><p>投影之后取消了原关系中的某些列，还取消某些元组（去重）</p><p>如：$\Pi_{Sname,Sdept}(Student)$</p><h4 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h4><p>$R \infty_{A \theta B} S$</p><p>其中A和B分别为R和S上度数相等且可比的属性组，θ为比较运算符 。连接运算从R和S的广义笛卡尔积R×S中选取R关系在A属性组上的值与S关系在B属性组上值满足比较关系的元组</p><h4 id="等值连接"><a href="#等值连接" class="headerlink" title="等值连接"></a>等值连接</h4><p>$R \infty_{A &#x3D; B} S$</p><h4 id="自然连接"><a href="#自然连接" class="headerlink" title="自然连接"></a>自然连接</h4><p>$R \infty S$</p><p>是一种特殊的等值连接，要求两个关系中进行比较的分量必须是相同的属性组，在结果中把重复的属性列去掉</p><h4 id="除"><a href="#除" class="headerlink" title="除"></a>除</h4><p>给定关系R(X,Y) 和S(Y,Z)，其中X,Y,Z为属性组。R中的Y与S中的Y可以有不同的属性名，但必须出自相同的域集。R与S的除运算得到一个新的关系P(X)，P是R中满足下列条件的元组在X属性列上的投影：元组在X上分量值x的象集Yx包含S在Y上投影的集合。</p><h2 id="数据库可靠性"><a href="#数据库可靠性" class="headerlink" title="数据库可靠性"></a>数据库可靠性</h2><h3 id="备份和恢复"><a href="#备份和恢复" class="headerlink" title="备份和恢复"></a>备份和恢复</h3><ul><li><p>完整数据库备份</p></li><li><p>差异备份</p><p>备份自上一次完整数据库备份后修改过的数据库页</p></li><li><p>事务日志备份</p><p>备份事务日志</p></li><li><p>文件或文件组备份</p></li></ul><p>还原数据库的一般顺序为：</p><p><strong>1、还原最新的数据库备份。</strong></p><p><strong>2、还原最后一次的差异数据库备份。</strong></p><p><strong>3、还原最后一次差异数据库备份后创建的所有事务日志备份。</strong></p><h3 id="事务控制"><a href="#事务控制" class="headerlink" title="事务控制"></a>事务控制</h3><p>事务ACID特性：</p><ul><li>原子性</li><li>一致性</li><li>隔离性</li><li>持续性</li></ul><h3 id="并发控制"><a href="#并发控制" class="headerlink" title="并发控制"></a>并发控制</h3><p>基于锁的事务并发控制</p><p>并发操作带来的数据不一致性：</p><ul><li><p>丢失修改</p><p>两事务都修改了数据</p></li><li><p>不可重复读</p><p>一事务的写撤销造成另一事务的读前后不一样</p></li><li><p>读脏数据</p><p>一事务的写撤销造成两事务的读数据不一致</p></li></ul><p>锁特点：多粒度</p><p>锁定：行锁定、列锁定、表锁定、数据库锁定</p><ul><li><strong>细粒度的锁定（比如只锁定一行）可以增加系统的并发度，但对多行的锁定却增加了开销</strong></li><li><strong>粗粒度的锁定（比如锁定整个表）降低了总开销，但也大大降低了系统的并发度</strong></li></ul><h2 id="数据库的安全性"><a href="#数据库的安全性" class="headerlink" title="数据库的安全性"></a>数据库的安全性</h2><h3 id="数据库安全性控制的常用方法"><a href="#数据库安全性控制的常用方法" class="headerlink" title="数据库安全性控制的常用方法"></a>数据库安全性控制的常用方法</h3><ul><li>用户标识和鉴定</li><li>存取控制、审计、视图</li><li>操作系统安全保护</li><li>密码存储</li></ul><h2 id="数据库的完整性"><a href="#数据库的完整性" class="headerlink" title="数据库的完整性"></a>数据库的完整性</h2><p><img src="/imgs/databasenote/11.png" alt="image-20230628201142892"></p><table><thead><tr><th><strong>粒   度</strong>    <strong>状态</strong></th><th><strong>列   级</strong></th><th><strong>元 组 级</strong></th><th><strong>关 系 级</strong></th></tr></thead><tbody><tr><td><strong>静 态</strong></td><td><strong>列定义</strong>  <strong>·****类型</strong>  <strong>·****格式</strong>  <strong>·****值域</strong>      <strong>·****空值</strong></td><td><strong>元组值应满足的条件</strong></td><td><strong>实体完整性约束</strong>    <strong>参照完整性约束</strong>    <strong>函数依赖约束</strong>     <strong>统计约束</strong></td></tr><tr><td><strong>动 态</strong></td><td><strong>改变列定义或列值</strong></td><td><strong>元组新旧值之间应满足的约束条件</strong></td><td><strong>关系新旧状态间应满足的约束条件</strong></td></tr></tbody></table><ul><li>域完整性</li><li>实体完整性</li><li>参考完整性</li><li>用户定义完整性</li></ul>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法课外思考题一</title>
      <link href="/2023/07/05/%E7%AE%97%E6%B3%95%E8%AF%BE%E5%A4%96%E6%80%9D%E8%80%83%E9%A2%98%E4%B8%80/"/>
      <url>/2023/07/05/%E7%AE%97%E6%B3%95%E8%AF%BE%E5%A4%96%E6%80%9D%E8%80%83%E9%A2%98%E4%B8%80/</url>
      
        <content type="html"><![CDATA[<h2 id="问题一"><a href="#问题一" class="headerlink" title="问题一"></a>问题一</h2><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>设计一栈结构，使得出栈、入栈以及求栈的最小值均能在$O (1)$时间内完成</p><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><p><strong>针对出入栈</strong>，由数据结构的顺序栈知识可以得知，出入栈的时间复杂度都是$O (1)$，因此对于出入栈只需要普通栈就可以实现问题要求；</p><p><strong>针对求栈的最小值</strong>，使用遍历法求栈最小值的时间复杂度为$O (n)$，因此需要设计一种特殊栈，通过记录栈中的最小值，在求栈的最小值时只需要将最小值输出即可，其时间复杂度为$O (1)$。</p><h3 id="算法思路"><a href="#算法思路" class="headerlink" title="算法思路"></a>算法思路</h3><p>先构建顺序栈的数据结构</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">typedef struct&#123;&#x2F;&#x2F;顺序栈    SElemType* base;    SElemtyoe* top;    int stacksize;&#125;SqStack;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后构建一个特殊的辅助栈，包括存储所有数据的原栈和存储最小值序列的新栈</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">typedef struct&#123;&#x2F;&#x2F;记录最小值的辅助栈    SqStack Data;    Sqstack MinData;&#125;MinStack;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>入栈操作</p><p>对于第一个元素，一定会进入两个栈；</p><p>对于后面的每一元素一定会进入Data栈，如果该元素&lt;&#x3D;Mindata栈的栈顶元素，则该元素进入Mindata栈，否则不进入</p></li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">void MinPush(Minstack* minstack, SElemType e) &#123;Push(&amp;minstack-&gt;Data, e);if (minstack-&gt;MinData.base&#x3D;&#x3D;minstack-&gt;MinData.top) &#123;Push(&amp;minstack-&gt;MinData, e);&#125;else &#123;if (e &lt;&#x3D; GetTop(minstack-&gt;MinData)) &#123;Push(&amp;minstack-&gt;MinData, e);&#125;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>出栈操作</p><p>对于某一元素的出栈，Data栈一定会执行出栈操作，如果Data栈的栈顶元素和MinData栈的栈顶元素相同，则MinData栈也执行出栈操作</p></li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">void MinPop(Minstack* minstack, SElemType* e) &#123;if (GetTop(minstack-&gt;Data) &#x3D;&#x3D; GetTop(minstack-&gt;MinData)) &#123;Pop(&amp;minstack-&gt;Data, e);Pop(&amp;minstack-&gt;MinData, e);return;&#125;Pop(&amp;minstack-&gt;Data, e);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>求栈最小值</p><p>最小值已经存储在MinData栈中，因此只需要获取MinData栈的栈顶元素就可以得到栈的最小值</p></li></ul><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">SElemType GetMin(Minstack* minstack) &#123;return GetTop(minstack-&gt;MinData);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="算法代码与分析"><a href="#算法代码与分析" class="headerlink" title="算法代码与分析"></a>算法代码与分析</h3><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include&lt;iostream&gt;#define STACK_INIT_SIZE 100using namespace std;typedef int SElemType;typedef struct &#123;SElemType* base;SElemType* top;int stacksize;&#125;SqStack;typedef struct &#123;SqStack Data;SqStack MinData;&#125;Minstack;void InitStack(SqStack* s) &#123;s-&gt;base &#x3D; (SElemType*)malloc(STACK_INIT_SIZE * sizeof(SElemType));s-&gt;top &#x3D; s-&gt;base;s-&gt;stacksize &#x3D; STACK_INIT_SIZE;&#125;void Push(SqStack* s, SElemType e) &#123;if (s-&gt;top - s-&gt;base &gt;&#x3D; s-&gt;stacksize) &#123;s-&gt;base &#x3D; (SElemType*)realloc(s-&gt;base, (s-&gt;stacksize + 10) * sizeof(SElemType));s-&gt;top &#x3D; s-&gt;base + s-&gt;stacksize;s-&gt;stacksize +&#x3D; 10;&#125;*s-&gt;top++ &#x3D; e;&#125;void Pop(SqStack* s, SElemType* e) &#123;*e &#x3D; *--s-&gt;top;&#125;SElemType GetTop(SqStack s) &#123;return *(--s.top);&#125;void DestroyStack(SqStack* s) &#123;free(s-&gt;base);s-&gt;base &#x3D; NULL;s-&gt;top &#x3D; NULL;s-&gt;stacksize &#x3D; 0;&#125;void MinInit(Minstack* minstack) &#123;InitStack(&amp;(minstack-&gt;Data));InitStack(&amp;(minstack-&gt;MinData));&#125;void MinDestroy(Minstack* minstack) &#123;DestroyStack(&amp;minstack-&gt;Data);DestroyStack(&amp;minstack-&gt;MinData);&#125;void MinPush(Minstack* minstack, SElemType e) &#123;Push(&amp;minstack-&gt;Data, e);if (minstack-&gt;MinData.base&#x3D;&#x3D;minstack-&gt;MinData.top) &#123;Push(&amp;minstack-&gt;MinData, e);&#125;else &#123;if (e &lt;&#x3D; GetTop(minstack-&gt;MinData)) &#123;Push(&amp;minstack-&gt;MinData, e);&#125;&#125;&#125;void MinPop(Minstack* minstack, SElemType* e) &#123;if (GetTop(minstack-&gt;Data) &#x3D;&#x3D; GetTop(minstack-&gt;MinData)) &#123;Pop(&amp;minstack-&gt;Data, e);Pop(&amp;minstack-&gt;MinData, e);return;&#125;Pop(&amp;minstack-&gt;Data, e);&#125;SElemType GetMin(Minstack* minstack) &#123;return GetTop(minstack-&gt;MinData);&#125;int main() &#123;Minstack minstack;SElemType e;MinInit(&amp;minstack);MinPush(&amp;minstack, 1);MinPush(&amp;minstack, 2);MinPush(&amp;minstack, 3);MinPush(&amp;minstack, 1);MinPop(&amp;minstack, &amp;e);cout &lt;&lt; GetMin(&amp;minstack) &lt;&lt; endl;system(&quot;pause&quot;);return 0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>实验结果</strong>：</p><p><img src="/imgs/sikao1/1.png" alt="image-20230302194755588"></p><p><strong>分析</strong>：</p><p>本算法能够实现出入栈、求栈最小值时间复杂度$O (1)$，但是在数据类型的定义上，关于栈和特殊栈存在重复，经查阅资料，可以采用结构体继承解决。</p><h2 id="问题二"><a href="#问题二" class="headerlink" title="问题二"></a>问题二</h2><h3 id="问题描述-1"><a href="#问题描述-1" class="headerlink" title="问题描述"></a>问题描述</h3><p>改进冒泡排序使得在最好情况下可以在线性时间内完成</p><h3 id="问题分析-1"><a href="#问题分析-1" class="headerlink" title="问题分析"></a>问题分析</h3><p>对于普通的冒泡排序算法，在最坏的情况下其时间复杂度为$O (n^2)$。第一趟排序进行了$(n-1)$次比较，第i趟排序进行了$(n-i)$次比较；但是对于$(n-1)$趟排序，如果序列在某一次排序时恰好有序，则在该次之后的每一次排序都是无用的，为了优化冒泡排序，只需要在该次以后终止冒泡排序。</p><h3 id="算法思路-1"><a href="#算法思路-1" class="headerlink" title="算法思路"></a>算法思路</h3><p>设置一个标志变量确定某一序列中的数据是否发生了交换，如果某一次冒泡过程中发现没有交换操作时，则说明序列已经排好序了，终止冒泡排序。</p><h3 id="算法代码及分析"><a href="#算法代码及分析" class="headerlink" title="算法代码及分析"></a>算法代码及分析</h3><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include&lt;iostream&gt;using namespace std;void BubbleSort(int array[], int n,int* num) &#123;for (int i &#x3D; 0; i &lt; n - 1; i++) &#123;bool flag &#x3D; true;for (int j &#x3D; 0; j &lt; n - i - 1; j++) &#123;if (array[j] &gt; array[j + 1]) &#123;int temp &#x3D; array[j];array[j] &#x3D; array[j + 1];array[j + 1] &#x3D; temp;flag &#x3D; false;&#125;&#125;if (flag) &#123;break;&#125;(*num)++;&#125;&#125;int main() &#123;int num &#x3D; 0;int array[] &#x3D; &#123; 5,4,3,6,7,8 &#125;;int n1 &#x3D; sizeof(array) &#x2F; sizeof(int);cout &lt;&lt; &quot;排序前：&quot;;for (int i &#x3D; 0; i &lt; n1; i++) &#123;cout &lt;&lt; array[i] &lt;&lt; &quot;,&quot;;&#125;cout &lt;&lt; endl;BubbleSort(array, n1, &amp;num);cout &lt;&lt; &quot;排序后：&quot;;for (int i &#x3D; 0; i &lt; n1; i++) &#123;cout &lt;&lt; array[i] &lt;&lt; &quot;,&quot;;&#125;cout &lt;&lt; endl;int array1[] &#x3D; &#123; 1,2,3,4,5,6 &#125;;int n2 &#x3D; sizeof(array1) &#x2F; sizeof(int);cout &lt;&lt; &quot;排序前：&quot;;for (int i &#x3D; 0; i &lt; n2; i++) &#123;cout &lt;&lt; array1[i] &lt;&lt; &quot;,&quot;;&#125;cout &lt;&lt; endl;cout &lt;&lt; num &lt;&lt; endl;num &#x3D; 0;BubbleSort(array1, n2, &amp;num);cout &lt;&lt; &quot;排序后：&quot;;for (int i &#x3D; 0; i &lt; n2; i++) &#123;cout &lt;&lt; array1[i] &lt;&lt; &quot;,&quot;;&#125;cout &lt;&lt; endl;cout &lt;&lt; num &lt;&lt; endl;system(&quot;pause&quot;);return 0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>实验结果</strong>：</p><p><img src="/imgs/sikao1/2.png" alt="image-20230302210218006"></p><p><strong>分析</strong>：</p><p>通过实验分析，在数据极端良好的情况下，能够实现时间复杂度为$O (1)$；在数据较为不良的情况下，仍能减少数据排序次数，使其在线性时间内完成。</p>]]></content>
      
      
      <categories>
          
          <category> 算法思考题 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 栈 </tag>
            
            <tag> 冒泡 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
